<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Welcome to Eleni's Blog Blog</title>
        <link>https://github.com/personal-blog/blog</link>
        <description>Welcome to Eleni's Blog Blog</description>
        <lastBuildDate>Thu, 18 Jul 2024 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Cilium Cluster Mesh on RKE2]]></title>
            <link>https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2</link>
            <guid>https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2</guid>
            <pubDate>Thu, 18 Jul 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[Introduction]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#introduction">​</a></h2>
<p>After spending some time working with the on-prem <a href="https://docs.rke2.io/" target="_blank" rel="noopener noreferrer">RKE2</a> lab setup, I came to notice a couple of issues while forming in an automated fashion the <a href="https://docs.cilium.io/en/stable/network/clustermesh/clustermesh/" target="_blank" rel="noopener noreferrer">Cilium cluster mesh</a> between on-prem clusters.</p>
<p>In today's post, we will go through the step-by-step process of forming a <strong>Cilium Cluster Mesh</strong> and explain any issues that might have arisen by following the <strong>GitOps</strong> approach. The cilium CLI will not be required. The deployment will be performed primarily via <code>Helm</code> and <code>kubectl</code>.</p>
<p>Additionally, we will use the <a href="https://docs.cilium.io/en/v1.15/network/clustermesh/clustermesh/#shared-certificate-authority" target="_blank" rel="noopener noreferrer">shared CA</a> (Certificate Authority) approach as this is a convenient way to form a cluster mesh in an automated fashion and also the best practise for the Hubble Relay setup. The approach will enable <strong>mTLS</strong> across clusters.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-setup">Lab Setup<a class="hash-link" aria-label="Direct link to Lab Setup" title="Direct link to Lab Setup" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#lab-setup">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+----------------------+----------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Cluster Name  |        Type          |       Version        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+----------------------+----------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   mesh01        | RKE2 managed cluster | RKE2 v1.27.14+rke2r1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   mesh02        | RKE2 managed cluster | RKE2 v1.27.14+rke2r1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+----------------------+----------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    Deployment     | Version  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Rancher2 Provider |  4.2.0   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     Cilium        | 1.15.500 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------+----------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#prerequisites">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="infrastructure">Infrastructure<a class="hash-link" aria-label="Direct link to Infrastructure" title="Direct link to Infrastructure" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#infrastructure">​</a></h3>
<p>For this demonstration, we assume readers have at least two RKE2 clusters up and running. In our case, to create an RKE2 cluster on-prem we used the <a href="https://registry.terraform.io/providers/rancher/rancher2/latest/docs" target="_blank" rel="noopener noreferrer">Rancher2</a> Terraform provider. The provider allows users to create different resources across different platforms alongside defining information for the RKE2 deployment like IP Address handling, and CNI (Container Network Interface) custom configuration.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cilium-cluster-mesh">Cilium Cluster Mesh<a class="hash-link" aria-label="Direct link to Cilium Cluster Mesh" title="Direct link to Cilium Cluster Mesh" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#cilium-cluster-mesh">​</a></h3>
<ul>
<li>The <strong>Cluster Name</strong> and the <strong>Cluster ID</strong> must be unique.</li>
<li>The <strong>Pods</strong> and the <strong>Services CIDR</strong> ranges must be unique across all the Kubernetes Clusters. The pods need to communicate over a unique IP address. See the IP address schema table above.</li>
<li>Node CIDRs must be unique. The Nodes to have IP connectivity.</li>
<li>The Cilium pods must connect to the <code>ClusterMesh API Server</code> service exposed on every Kubernetes cluster.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#resources">​</a></h3>
<p>Ensure the below are satisfied.</p>
<ol>
<li>Helm CLI installed</li>
<li>kubectl installed</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-0-rke2-terraform-provider">Step 0: RKE2 Terraform Provider<a class="hash-link" aria-label="Direct link to Step 0: RKE2 Terraform Provider" title="Direct link to Step 0: RKE2 Terraform Provider" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#step-0-rke2-terraform-provider">​</a></h2>
<p>The below snippet is an example configuration on how to deploy an RKE2 cluster via the <strong>Rancher2</strong> Provider.</p>
<div class="language-terraform codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-terraform codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  # RKE2 configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource "rancher2_cluster_v2" "rke2" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Define basic cluster details like labels and annotations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    annotations           = var.rancher_env.cluster_annotations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes_version    = var.rancher_env.rke2_version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels                = var.rancher_env.cluster_labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_network_policy = var.rancher_env.network_policy # Option to enable or disable Project Network Isolation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name                  = var.rancher_env.cluster_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Define the Cilium Configuration for the cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      chart_values = &lt;&lt;-EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rke2-cilium:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          k8sServiceHost: 127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          k8sServicePort: 6443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          kubeProxyReplacement: true # Prepare the deployment for kube-proxy replacement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          operator:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hubble: # Enable Hubble for observability </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            peerService:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              clusterDomain: cluster.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            relay:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tls:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              auto:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                certValidityDuration: 1095</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                method: helm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ui:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Apply machine global settings for the clusters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      machine_global_config = &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cni: "cilium" # Enable Cilium CNI for every cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cluster-cidr: ${var.rke_cluster_cidr}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        service-cidr: ${var.rke_service_cidr}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        disable-kube-proxy: true # Disable kube-proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        etcd-expose-metrics: false # Do not expose the etcd metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Start building the controller and workder nodes dynamically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dynamic "machine_pools" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for_each = var.node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        content {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cloud_credential_secret_name = data.rancher2_cloud_credential.auth.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          control_plane_role           = machine_pools.key == "ctl_plane" ? true : false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          etcd_role                    = machine_pools.key == "ctl_plane" ? true : false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name                         = machine_pools.value.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          quantity                     = machine_pools.value.quantity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          worker_role                  = machine_pools.key != "ctl_plane" ? true : false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          machine_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            kind = rancher2_machine_config_v2.nodes[machine_pools.key].kind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name = replace(rancher2_machine_config_v2.nodes[machine_pools.key].name, "_", "-")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      machine_selector_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config = null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As the focus here is more on the <strong>Cilium Cluster Mesh</strong> setup, we will not go into much detail about the Terraform RKE2 deployment. If there is demand for an in-depth blog post about Terraform RKE2 deployments, feel free to get in touch.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-export-kubeconfig">Step 1: Export kubeconfig<a class="hash-link" aria-label="Direct link to Step 1: Export kubeconfig" title="Direct link to Step 1: Export kubeconfig" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#step-1-export-kubeconfig">​</a></h2>
<p>Either from the Terraform execution plan or via the Rancher UI, collect the kubeconfig of the RKE2 clusters. Alternatively, we can <code>SSH</code> into one of the RKE2 master nodes and collect the <code>kubeconfig</code> found in the directory <code>/etc/rancher/rke2/rke2.yaml</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ export KUBECONFIG=&lt;directory of kubeconfig&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl nodes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-helm-list-and-values-export">Step 2: Helm list and values export<a class="hash-link" aria-label="Direct link to Step 2: Helm list and values export" title="Direct link to Step 2: Helm list and values export" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#step-2-helm-list-and-values-export">​</a></h2>
<p>RKE2 comes with its own Cilium CNI Helm chart. That means RKE2 clusters will have an RKE2 Cilium Helm chart deployment in the <code>kube-system</code> namespace.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="validate">Validate<a class="hash-link" aria-label="Direct link to Validate" title="Direct link to Validate" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#validate">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ export KUBECONFIG=&lt;directory of kubeconfig&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ helm list -n kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                            	NAMESPACE  	REVISION	UPDATED                                	STATUS  	CHART                                       	APP VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-cilium                     	kube-system	1       	2024-07-13 09:32:09.981662 +0200 CEST  	deployed	rke2-cilium-1.15.500                        	1.15.5     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-coredns                    	kube-system	1       	2024-07-13 07:05:49.846980773 +0000 UTC	deployed	rke2-coredns-1.29.002                       	1.11.1     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-ingress-nginx              	kube-system	1       	2024-07-13 07:06:24.63272854 +0000 UTC 	deployed	rke2-ingress-nginx-4.8.200                  	1.9.3      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-metrics-server             	kube-system	1       	2024-07-13 07:06:24.86243331 +0000 UTC 	deployed	rke2-metrics-server-2.11.100-build2023051513	0.6.3      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-snapshot-controller        	kube-system	1       	2024-07-13 07:06:26.764326178 +0000 UTC	deployed	rke2-snapshot-controller-1.7.202            	v6.2.1     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-snapshot-controller-crd    	kube-system	1       	2024-07-13 07:06:24.217899546 +0000 UTC	deployed	rke2-snapshot-controller-crd-1.7.202        	v6.2.1     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-snapshot-validation-webhook	kube-system	1       	2024-07-13 07:06:24.544748567 +0000 UTC	deployed	rke2-snapshot-validation-webhook-1.7.302    	v6.2.2 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="collect-rke2-cilium-helm-values">Collect rke2-cilium Helm Values<a class="hash-link" aria-label="Direct link to Collect rke2-cilium Helm Values" title="Direct link to Collect rke2-cilium Helm Values" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#collect-rke2-cilium-helm-values">​</a></h3>
<p><strong>mesh01</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ helm get values rke2-cilium -n kube-system -o yaml &gt; values_mesh01.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>mesh02</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ helm get values rke2-cilium -n kube-system -o yaml &gt; values_mesh02.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Example values_mesh01.yaml</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cattle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">clusterId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">m</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">8ffz659l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">clusterCIDR</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.244.0.0/16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">clusterCIDRv4</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.244.0.0/16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">clusterDNS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.96.0.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">clusterDomain</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cluster.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rke2DataDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/lib/rancher/rke2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serviceCIDR</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.96.0.0/18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">hubble</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">peerService</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">clusterDomain</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cluster.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">relay</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">auto</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">certValidityDuration</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1095</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">method</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> helm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ui</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">k8sServiceHost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">k8sServicePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kubeProxyReplacement</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The configuration comes from the <code>machine_global_config</code> and <code>chart_values</code> sections defined in the Terraform code found in <a href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#step-0-rke2-terraform-provider">Step 0</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-cilium-cluster-mesh-helm-values">Step 3: Cilium Cluster Mesh Helm Values<a class="hash-link" aria-label="Direct link to Step 3: Cilium Cluster Mesh Helm Values" title="Direct link to Step 3: Cilium Cluster Mesh Helm Values" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#step-3-cilium-cluster-mesh-helm-values">​</a></h2>
<p>To set up the Cilium cluster mesh, we need to include the <code>rke2-charts</code> repo and later on, update the Helm values with the required cluster mesh settings. For this demonstration, we will use the <code>NodePort</code> deployment. For production environments, a <code>LoadBalancer</code> deployment is recommended as we do not have to rely on Node availability.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-rke2-charts-repo">Add rke2-charts Repo<a class="hash-link" aria-label="Direct link to Add rke2-charts Repo" title="Direct link to Add rke2-charts Repo" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#add-rke2-charts-repo">​</a></h3>
<p>The action should be performed in both clusters.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ helm repo add rke2-charts https://rke2-charts.rancher.io/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ helm repo update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-mesh01-helm-values">Update mesh01 Helm Values<a class="hash-link" aria-label="Direct link to Update mesh01 Helm Values" title="Direct link to Update mesh01 Helm Values" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#update-mesh01-helm-values">​</a></h3>
<p>On the same level as global, add the below configuration.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ca</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cert</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Base64 encoded shared CA crt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Base64 encoded shared CA key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">cluster</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mesh01 </span><span class="token comment" style="color:#999988;font-style:italic"># The unique name of the cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The unique ID of the cluster used for the cluster mesh formation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">clustermesh</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">apiserver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort </span><span class="token comment" style="color:#999988;font-style:italic"># Set the Clustermesh API service to be of type NodePort. Not recommended for Production environments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nodePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32379</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Define the listening port for the Clustermesh API service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">authMode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">extraDnsNames</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mesh01.mesh.cilium.io"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Define the extra DNS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">clusters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ips</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> &lt;Node IP</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The Node IP of the mesh02 cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mesh02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32380</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The NodePort defined on mesh02 for the Clustermesh API service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">domain</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mesh.cilium.io"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Define the default domain for the mesh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">useAPIServer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Enable the Clustermesh API deployment</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-mesh02-helm-values">Update mesh02 Helm Values<a class="hash-link" aria-label="Direct link to Update mesh02 Helm Values" title="Direct link to Update mesh02 Helm Values" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#update-mesh02-helm-values">​</a></h3>
<p>On the same level as global, add the below configuration.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ca</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cert</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Base64 encoded shared CA crt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Base64 encoded shared CA key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">cluster</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mesh02 </span><span class="token comment" style="color:#999988;font-style:italic"># The unique name of the cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The unique ID of the cluster used for the cluster mesh formation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">clustermesh</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">apiserver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort </span><span class="token comment" style="color:#999988;font-style:italic"># Set the Clustermesh API service to be of type NodePort. Not recommended for production environments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nodePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32380</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Define the listening port for the Clustermesh API service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">authMode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">extraDnsNames</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mesh02.mesh.cilium.io"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Define the extra DNS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">clusters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ips</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> &lt;Node IP</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The Node IP of the mesg01 cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mesh01 </span><span class="token comment" style="color:#999988;font-style:italic"># Define the name of the cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32379</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The NodePort defined on mesh02 for the Clustermesh API service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">domain</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mesh.cilium.io"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Define the default domain for the mesh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">useAPIServer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Enable the Clustermesh API deployment</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-mesh01mesh02-helm-deployment">Update mesh01/mesh02 Helm deployment<a class="hash-link" aria-label="Direct link to Update mesh01/mesh02 Helm deployment" title="Direct link to Update mesh01/mesh02 Helm deployment" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#update-mesh01mesh02-helm-deployment">​</a></h3>
<p>To ensure the updated Helm values are applied, we will use the HELM CLI to update the <code>rke2-cilium</code> deployment.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ helm upgrade rke2-cilium rke2-charts/rke2-cilium --version 1.15.500 --namespace kube-system -f values_mesh01.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ helm list -n kube-system</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Perform the commands for the <code>mesh02</code> cluster.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The <code>helm upgrade</code> command will create a new revision of the <code>rke2-cilium</code> application and show if the update was successful or not. Additionally, the cilium daemonset will get restarted and the Clustermesh API deployment will get created. Execute the commands below to double-check the update action.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl rollout status daemonset cilium -n kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods,svc -n kube-system | grep -i clustermesh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-validate-cilium-cluster-mesh">Step 4: Validate Cilium Cluster Mesh<a class="hash-link" aria-label="Direct link to Step 4: Validate Cilium Cluster Mesh" title="Direct link to Step 4: Validate Cilium Cluster Mesh" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#step-4-validate-cilium-cluster-mesh">​</a></h2>
<p>As we do not use the Cilium CLI, to ensure the Cilium cluster mesh works as expected, we will exec into the cilium daemonset and check the required details.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get ds -n kube-system | grep -i cilium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium                          4         4         4       4            4           kubernetes.io/os=linux   7d6h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="on-mesh01-and-mesh02">On mesh01 and mesh02<a class="hash-link" aria-label="Direct link to On mesh01 and mesh02" title="Direct link to On mesh01 and mesh02" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#on-mesh01-and-mesh02">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl exec -it ds/cilium -n kube-system -- cilium status | grep -i clustermesh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Defaulted container "cilium-agent" out of: cilium-agent, install-portmap-cni-plugin (init), config (init), mount-cgroup (init), apply-sysctl-overwrites (init), mount-bpf-fs (init), clean-cilium-state (init), install-cni-binaries (init)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ClusterMesh:             1/1 clusters ready, 11 global-services</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>On both sides, the <code>ClusterMesh</code> should point to <code>1/1 clusters ready</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl exec -it ds/cilium -n kube-system -- cilium-health status               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Defaulted container "cilium-agent" out of: cilium-agent, install-portmap-cni-plugin (init), config (init), mount-cgroup (init), apply-sysctl-overwrites (init), mount-bpf-fs (init), clean-cilium-state (init), install-cni-binaries (init)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Probe time:   2024-07-20T13:58:47Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Nodes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mesh01/mesh01-controller-3d16581b-7q5bj (localhost):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host connectivity to x.x.x.x:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=693.829µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=118.583µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Endpoint connectivity to 10.244.1.71:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=688.411µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=251.927µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mesh01/mesh01-controller-3d16581b-v58rq:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host connectivity to x.x.x.x:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=671.007µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=237.395µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Endpoint connectivity to 10.244.0.75:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=702.976µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=342.115µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mesh01/mesh01-worker-7ced0c6c-lz9sp:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host connectivity to x.x.x.x:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=819.21µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=397.398µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Endpoint connectivity to 10.244.3.215:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=821.223µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=465.965µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mesh01/mesh01-worker-7ced0c6c-w294x:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host connectivity to x.x.x.x:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=738.787µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=335.803µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Endpoint connectivity to 10.244.2.36:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=693.326µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=426.571µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mesh02/mesh02-controller-52d8e160-b27rn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host connectivity to x.x.x.x:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=683.278µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=335.076µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Endpoint connectivity to 10.245.0.106:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=818.386µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=387.314µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mesh02/mesh02-controller-52d8e160-q4rvf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host connectivity to x.x.x.x:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=683.097µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=301.448µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Endpoint connectivity to 10.245.1.75:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=748.101µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=510.124µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mesh02/mesh02-worker-a1c14ae0-5l759:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host connectivity to x.x.x.x:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=631.954µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=266.391µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Endpoint connectivity to 10.245.3.232:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=751.853µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=433.049µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mesh02/mesh02-worker-a1c14ae0-c7tcb:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host connectivity to x.x.x.x:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=671.823µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=365.949µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Endpoint connectivity to 10.245.2.69:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ICMP to stack:   OK, RTT=690.894µs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HTTP to agent:   OK, RTT=466.73µs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>With the cilium-health status command, you should be able to see all the nodes from both clusters. Check the ICMP and HTTP status. Should be "OK".</p><p>Also, it might take a couple of minutes till the cilium-health status is available.</p><p>If the time-out persists, have a look at the firewall rules and whether traffic between the clusters is allowed.</p></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The NodePort IP addresses set for the cluster mesh need to be the IP addresses of the worker node instead of the master node. If they are the master node, the Cilium Cluster Mesh will not get deployed and we will get the below error.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">remote-etcd-cluster01                                                             4m25s ago      4s ago       22      failed to detect whether the cluster configuration is required: etcdserver: permission denied </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-5-hubble-ui">Step 5: Hubble UI<a class="hash-link" aria-label="Direct link to Step 5: Hubble UI" title="Direct link to Step 5: Hubble UI" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#step-5-hubble-ui">​</a></h2>
<p>To work with the Hubble UI we can use the <code>kubectl port-forward</code> of the Hubble UI service or update the existing <code>rke2-cilium</code> deployment on one of the nodes and expose the Hubble UI as a <code>NodePort</code> service. Just include the below in the <code>values_mesh01.yaml</code> or the <code>values_mesh02.yaml</code> file.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ui</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For more information about the RKE2 Cilium Helm Chart values, have a look <a href="https://artifacthub.io/packages/helm/rke2-charts/rke2-cilium/1.15.500" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusions">Conclusions<a class="hash-link" aria-label="Direct link to Conclusions" title="Direct link to Conclusions" href="https://github.com/personal-blog/blog/cilium-cluster-mesh-rke2#conclusions">​</a></h2>
<p>This is it! We performed a Cilium cluster mesh between two on-prem RKE2 clusters in just a few steps! 🎉</p>
<p>It's a wrap for this post! 🎉 Thanks for reading! Stay tuned for more exciting updates!</p>]]></content:encoded>
            <category>Cilium</category>
            <category>RKE2</category>
            <category>Open Source</category>
            <category>Kubernetes</category>
            <category>GitOps</category>
            <category>DevOps</category>
        </item>
        <item>
            <title><![CDATA[Cilium on EKS with Sveltos]]></title>
            <link>https://github.com/personal-blog/blog/cilium-eks-sveltos</link>
            <guid>https://github.com/personal-blog/blog/cilium-eks-sveltos</guid>
            <pubDate>Mon, 15 Jul 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[Introduction]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#introduction">​</a></h2>
<p>In today's blog post, we will demonstrate an easy way of deploying and controlling <a href="https://docs.cilium.io/en/v1.14/" target="_blank" rel="noopener noreferrer">Cilium</a> on an <a href="https://aws.amazon.com/eks/" target="_blank" rel="noopener noreferrer">EKS</a> cluster with <a href="https://github.com/projectsveltos" target="_blank" rel="noopener noreferrer">Sveltos</a>.</p>
<p>As the majority of the documentation out there provides a step-by-step installation directly with the Helm chart commands, we decided to demonstrate a different approach, the GitOps approach, with the use of <a href="https://projectsveltos.github.io/sveltos/addons/addons/" target="_blank" rel="noopener noreferrer">Sveltos ClusterProfile</a> CRD (Custom Resource Definition).</p>
<p>We will utilise the Terraform <a href="https://registry.terraform.io/modules/terraform-aws-modules/eks/aws/latest" target="_blank" rel="noopener noreferrer">AWS EKS module</a> to create an EKS cluster. Once the cluster is up and running, we will register it with Sveltos. Then, we will update the <a href="https://docs.aws.amazon.com/eks/latest/userguide/managing-vpc-cni.html" target="_blank" rel="noopener noreferrer"><code>aws-core</code> daemonset</a> to support  ENI mode and remove the <code>kube-proxy</code> Kubernetes resources as Cilium will take over.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="diagram">Diagram<a class="hash-link" aria-label="Direct link to Diagram" title="Direct link to Diagram" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#diagram">​</a></h2>
<p><img decoding="async" loading="lazy" alt="Cilium, Sveltos, EKS" src="https://github.com/personal-blog/assets/images/cilium_sveltos_eks-96202e60f24f3661fb326790c8b28ead.jpg" width="1600" height="870" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-setup">Lab Setup<a class="hash-link" aria-label="Direct link to Lab Setup" title="Direct link to Lab Setup" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#lab-setup">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+-------------------+--------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Cluster Name  |        Type       |         Version          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+-------------------+--------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   mgmt          | Management Cluster| RKE2 v1.28.9+rke2r1      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| eks-test01      | Managed Cluster   | EKS v1.28.10-eks-49c6de4 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+-------------------+--------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  Deployment | Version  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    Cilium   | v1.14.8  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  sveltosctl | v0.27.0  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+----------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#prerequisites">​</a></h2>
<p>To follow along with the blog post, ensure the below are satisfied.</p>
<ol>
<li>AWS Service Account</li>
<li>AWS CLI installed</li>
<li>Terraform installed</li>
<li>kubectl installed</li>
<li>sveltosctl installed</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-create-eks-cluster-with-terraform">Step 1: Create EKS Cluster with Terraform<a class="hash-link" aria-label="Direct link to Step 1: Create EKS Cluster with Terraform" title="Direct link to Step 1: Create EKS Cluster with Terraform" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#step-1-create-eks-cluster-with-terraform">​</a></h2>
<p>The easiest way to spin up an EKS cluster is by following the recommended training and resources from the Hashicorp website. Find the training material and the Git repository further below.</p>
<ul>
<li>
<p>Training: <a href="https://developer.hashicorp.com/terraform/tutorials/kubernetes/eks" target="_blank" rel="noopener noreferrer">https://developer.hashicorp.com/terraform/tutorials/kubernetes/eks</a></p>
</li>
<li>
<p>GitHub Repository: <a href="https://github.com/hashicorp/learn-terraform-provision-eks-cluster" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/learn-terraform-provision-eks-cluster</a></p>
</li>
</ul>
<p>To execute the Terraform plan, a valid <code>AWS Service Account</code> should be available with the right permissions to create the required resources. For more information about the AWS Service Accounts, have a look <a href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>To get the cluster <code>kubeconfig</code> and start interacting with the cluster, the <strong>AWS CLI</strong> is used. Modify and execute the command below.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ aws eks update-kubeconfig --region &lt;the region the cluster created&gt; --name &lt;the name of the cluster&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The command will save the kubeconfig in the default directory <code>~/.kube/config</code>. If the file should be stored elsewhere, pass the argument <code>--kubeconfig</code> and specify the output directory. For more details, check out the <a href="https://docs.aws.amazon.com/cli/latest/reference/eks/update-kubeconfig.html" target="_blank" rel="noopener noreferrer">link</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-register-cluster-withsveltos">Step 2: Register Cluster with&nbsp;Sveltos<a class="hash-link" aria-label="Direct link to Step 2: Register Cluster with&nbsp;Sveltos" title="Direct link to Step 2: Register Cluster with&nbsp;Sveltos" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#step-2-register-cluster-withsveltos">​</a></h2>
<p>Once we have access to the cluster, it is time to proceed with the Sveltos cluster registration. As this is a cloud Kubernetes cluster, we need to ensure Sveltos has the <strong>right set of permissions</strong> to perform the Kubernetes deployments and add-ons. To do that, we will utilise <code>sveltosctl</code> and generate a new kubeconfig file.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="generate-sveltos-kubeconfig">Generate Sveltos kubeconfig<a class="hash-link" aria-label="Direct link to Generate Sveltos kubeconfig" title="Direct link to Generate Sveltos kubeconfig" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#generate-sveltos-kubeconfig">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ export KUBECONFIG=&lt;directory of the EKS kubeconfig file&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ sveltosctl generate kubeconfig --create --expirationSeconds=86400</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>sveltosctl</code> command will create a kubeconfig file. The file will be used for the Sveltos cluster registration.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="register-ekscluster">Register EKS&nbsp;Cluster<a class="hash-link" aria-label="Direct link to Register EKS&nbsp;Cluster" title="Direct link to Register EKS&nbsp;Cluster" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#register-ekscluster">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sveltosctl register cluster --namespace=&lt;namespace&gt; --cluster=&lt;cluster name&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --kubeconfig=&lt;path to Sveltos file with Kubeconfig&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --labels=env=test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The command above will register the EKS cluster with Sveltos on the mentioned <strong>namespace</strong>, and <strong>name</strong> and will attach the cluster <strong>label</strong> <code>env=test</code> defined.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If the namespace does not exist in the management cluster, the command will fail with the namespace not found error. Ensure the defined namespace exists in the cluster before registration.</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ export KUBECONFIG=&lt;Sveltos managament cluster&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get sveltosclusters -A --show-labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAMESPACE        NAME         READY   VERSION                LABELS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mgmt             mgmt         true    v1.28.9+rke2r1         sveltos-agent=present</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test             eks-test01   true    v1.28.10-eks-49c6de4   env=test,sveltos-agent=present</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-update-the-ekscluster">Step 3: Update the EKS&nbsp;cluster<a class="hash-link" aria-label="Direct link to Step 3: Update the EKS&nbsp;cluster" title="Direct link to Step 3: Update the EKS&nbsp;cluster" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#step-3-update-the-ekscluster">​</a></h2>
<p>As we would like to use Cilium with the Kube Proxy replacement and the <a href="https://docs.aws.amazon.com/AmazonECS/latest/bestpracticesguide/networking-networkmode-awsvpc.html" target="_blank" rel="noopener noreferrer">ENI</a> mode enabled, we need to perform additional actions. As the <code>kube-proxy</code> daemonset is already installed, we have to remove all related resources and update the <code>aws-node</code> daemonset to support the ENI mode.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="validation">Validation<a class="hash-link" aria-label="Direct link to Validation" title="Direct link to Validation" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#validation">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods,ds -n kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                      READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/aws-node-4x8sq                        2/2     Running   0          16m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/aws-node-vjtlx                        2/2     Running   0          16m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/aws-node-xp7vl                        2/2     Running   0          16m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/coredns-648485486-t5sxm               1/1     Running   0          20m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/coredns-648485486-tv4h5               1/1     Running   0          20m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/ebs-csi-controller-5df9db689f-8hmdm   6/6     Running   0          15m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/ebs-csi-controller-5df9db689f-qmxhs   6/6     Running   0          15m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/ebs-csi-node-2rspx                    3/3     Running   0          15m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/ebs-csi-node-gvtfj                    3/3     Running   0          15m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/ebs-csi-node-t96ch                    3/3     Running   0          15m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/kube-proxy-4jxlt                      1/1     Running   0          16m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/kube-proxy-hgx9h                      1/1     Running   0          16m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/kube-proxy-l877x                      1/1     Running   0          16m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                  DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR              AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemonset.apps/aws-node               3         3         3       3            3           &lt;none&gt;                     20m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemonset.apps/ebs-csi-node           3         3         3       3            3           kubernetes.io/os=linux     16m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemonset.apps/ebs-csi-node-windows   0         0         0       0            0           kubernetes.io/os=windows   16m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemonset.apps/kube-proxy             3         3         3       3            3           &lt;none&gt;                     20m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="delete-kube-proxy-resources">Delete kube-proxy Resources<a class="hash-link" aria-label="Direct link to Delete kube-proxy Resources" title="Direct link to Delete kube-proxy Resources" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#delete-kube-proxy-resources">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ export KUBECONFIG=&lt;directory of the EKS kubeconfig file&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl delete ds kube-proxy -n kube-system # Remove the kube-proxy daemonset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl delete cm kube-proxy -n kube-system # Remove the kube-proxy ConfigMap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-aws-node-resources">Update aws-node Resources<a class="hash-link" aria-label="Direct link to Update aws-node Resources" title="Direct link to Update aws-node Resources" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#update-aws-node-resources">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl patch daemonset aws-node --type='strategic' -p='{"spec":{"template":{"spec":{"nodeSelector":{"io.cilium/aws-node-enabled":"true"}}}}}' -n kube-system # This is required based on the Cilium documentation to enable the ENI mode</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods,ds -n kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                      READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/coredns-648485486-t5sxm               1/1     Running   0          22m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/coredns-648485486-tv4h5               1/1     Running   0          22m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/ebs-csi-controller-5df9db689f-8hmdm   6/6     Running   0          17m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/ebs-csi-controller-5df9db689f-qmxhs   6/6     Running   0          17m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/ebs-csi-node-2rspx                    3/3     Running   0          17m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/ebs-csi-node-gvtfj                    3/3     Running   0          17m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/ebs-csi-node-t96ch                    3/3     Running   0          17m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                  DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                     AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemonset.apps/aws-node               0         0         0       0            0           io.cilium/aws-node-enabled=true   22m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemonset.apps/ebs-csi-node           3         3         3       3            3           kubernetes.io/os=linux            17m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemonset.apps/ebs-csi-node-windows   0         0         0       0            0           kubernetes.io/os=windows          17m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The aws-node daemonset scaled down to 0 replicas.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-create-sveltos-clusterprofile">Step 4: Create Sveltos ClusterProfile<a class="hash-link" aria-label="Direct link to Step 4: Create Sveltos ClusterProfile" title="Direct link to Step 4: Create Sveltos ClusterProfile" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#step-4-create-sveltos-clusterprofile">​</a></h3>
<p>It is time to create a <strong>Sveltos ClusterProfile</strong> and deploy <strong>Cilium</strong> to the EKS cluster with the label set to <code>env=test</code>. Following the Cilium <a href="https://docs.cilium.io/en/v1.14/installation/k8s-install-helm/" target="_blank" rel="noopener noreferrer">documentation</a>, we will enable the required Helm values for the <code>kube-proxy </code>replacement and the ENI mode.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config.projectsveltos.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterProfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cilium</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1148</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">clusterSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> env=test </span><span class="token comment" style="color:#999988;font-style:italic"># Deploy Cilium v1.14.8 to any cluster with the cluster label set to env=test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">helmCharts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">chartName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cilium/cilium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">chartVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1.14.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">helmChartAction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">releaseName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cilium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">releaseNamespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repositoryName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cilium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repositoryURL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//helm.cilium.io/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      eni:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      ipam:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        mode: eni</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      egressMasqueradeInterfaces: eth0</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      routingMode: native</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      kubeProxyReplacement: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      k8sServiceHost: &lt;The Server API FQDN or IP Address&gt; # The information can be exctracted from the kubeconfig file or the AWS UI</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      k8sServicePort: &lt;The Server API listening port&gt; # The information can be extracted from the kubeconfig file or the AWS UI</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      nodePort:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      debug:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        enabled: true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The ClusterProfile will deploy Cilium CNI to any cluster with the cluster label set to <code>env=test</code>. It will then deploy the Cilium Helm chart in the <code>kube-system</code> namespace alongside the kube-proxy replacement and the ENI mode. Hubble is also enabled.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-5-deploy-cilium-andvalidate">Step 5: Deploy Cilium and&nbsp;Validate<a class="hash-link" aria-label="Direct link to Step 5: Deploy Cilium and&nbsp;Validate" title="Direct link to Step 5: Deploy Cilium and&nbsp;Validate" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#step-5-deploy-cilium-andvalidate">​</a></h2>
<p>To see and evaluate the results, the Sveltos ClusterProfile will be deployed to the management cluster.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ export KUBECONFIG=&lt;Sveltos managament cluster&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply -f "clusterprofile_cilium1148.yaml"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="validation-1">Validation<a class="hash-link" aria-label="Direct link to Validation" title="Direct link to Validation" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#validation-1">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./sveltosctl show addons</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+---------------+-------------+--------+---------+-------------------------------+----------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     CLUSTER     | RESOURCE TYPE |  NAMESPACE  |  NAME  | VERSION |             TIME              |          PROFILES          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+---------------+-------------+--------+---------+-------------------------------+----------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test/eks-test01 | helm chart    | kube-system | cilium | 1.14.8  | 2024-06-18 14:39:26 +0000 UTC | ClusterProfile/cilium-1148 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+---------------+-------------+--------+---------+-------------------------------+----------------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ export KUBECONFIG=&lt;directory of the EKS kubeconfig file&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods -n kube-system | grep -i cilium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-2vg4c                          1/1     Running             0          54s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-operator-594f4858f6-km2wh      1/1     Running             0          54s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-operator-594f4858f6-xx2q6      1/1     Running             0          55s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-qrwwf                          1/1     Running             0          55s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-s55v5                          1/1     Running             0          54s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl exec -it cilium-2vg4c -n kube-system -- cilium status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Defaulted container "cilium-agent" out of: cilium-agent, config (init), mount-cgroup (init), apply-sysctl-overwrites (init), mount-bpf-fs (init), clean-cilium-state (init), install-cni-binaries (init)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KVStore:                 Ok   Disabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Kubernetes:              Ok   1.28+ (v1.28.10-eks-49c6de4) [linux/amd64]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Kubernetes APIs:         ["EndpointSliceOrEndpoint", "cilium/v2::CiliumClusterwideNetworkPolicy", "cilium/v2::CiliumEndpoint", "cilium/v2::CiliumNetworkPolicy", "cilium/v2::CiliumNode", "cilium/v2alpha1::CiliumCIDRGroup", "core/v1::Namespace", "core/v1::Pods", "core/v1::Service", "networking.k8s.io/v1::NetworkPolicy"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KubeProxyReplacement:    True   [eth0 10.0.1.150 (Direct Routing), eth1 10.0.1.37]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-nginx-application">Deploy Nginx Application<a class="hash-link" aria-label="Direct link to Deploy Nginx Application" title="Direct link to Deploy Nginx Application" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#deploy-nginx-application">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply -f "nginx.yaml"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods,svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                            READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/my-nginx-684dd4dcd4-gl9rm   1/1     Running   0          18s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/my-nginx-684dd4dcd4-nk9mm   1/1     Running   0          18s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/kubernetes   ClusterIP   172.20.0.1      &lt;none&gt;        443/TCP        33m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/my-nginx     NodePort    172.20.80.220   &lt;none&gt;        80:32449/TCP   3s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cilium-validation">Cilium Validation<a class="hash-link" aria-label="Direct link to Cilium Validation" title="Direct link to Cilium Validation" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#cilium-validation">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n kube-system exec ds/cilium -- cilium service list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Defaulted container "cilium-agent" out of: cilium-agent, config (init), mount-cgroup (init), apply-sysctl-overwrites (init), mount-bpf-fs (init), clean-cilium-state (init), install-cni-binaries (init)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ID   Frontend             Service Type   Backend                         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1    172.20.0.1:443       ClusterIP      1 =&gt; 10.0.1.15:443 (active)     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         2 =&gt; 10.0.2.226:443 (active)    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2    172.20.208.197:443   ClusterIP      1 =&gt; 10.0.1.150:4244 (active)   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3    172.20.22.66:80      ClusterIP      1 =&gt; 10.0.3.36:4245 (active)    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4    172.20.141.67:80     ClusterIP      1 =&gt; 10.0.2.229:8081 (active)   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5    172.20.0.10:53       ClusterIP      1 =&gt; 10.0.1.144:53 (active)     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         2 =&gt; 10.0.3.123:53 (active)     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6    172.20.80.220:80     ClusterIP      1 =&gt; 10.0.1.216:80 (active)     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         2 =&gt; 10.0.3.39:80 (active)      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7    10.0.1.150:32449     NodePort       1 =&gt; 10.0.1.216:80 (active)     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         2 =&gt; 10.0.3.39:80 (active)      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8    10.0.1.37:32449      NodePort       1 =&gt; 10.0.1.216:80 (active)     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         2 =&gt; 10.0.3.39:80 (active)      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9    0.0.0.0:32449        NodePort       1 =&gt; 10.0.1.216:80 (active)     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         2 =&gt; 10.0.3.39:80 (active)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>From the output above, we can observe that Cilium eBPF kube-proxy replacement created the NodePort service for Nginx.</p>
<p>As the blog post is not intended to outline in depth how the kube-proxy replacement works, check out the <a href="https://docs.cilium.io/en/v1.14/network/kubernetes/kubeproxy-free/" target="_blank" rel="noopener noreferrer">link</a> for further tests.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusions">Conclusions<a class="hash-link" aria-label="Direct link to Conclusions" title="Direct link to Conclusions" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#conclusions">​</a></h2>
<p>We demonstrated an easy way of deploying Cilium CNI to an EKS cluster with the Sveltos ClusterProfile. The complete lifecycle of the CNI is now controlled by Sveltos and without external dependencies.</p>
<p>Take advantage of the <a href="https://projectsveltos.github.io/sveltos/template/intro_template/" target="_blank" rel="noopener noreferrer">Sveltos Templating</a> and the <a href="https://projectsveltos.github.io/sveltos/events/addon_event_deployment/" target="_blank" rel="noopener noreferrer">Sveltos Event Framework</a> capabilities to make every Kubernetes deployment and add-on easier!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="contact">Contact<a class="hash-link" aria-label="Direct link to Contact" title="Direct link to Contact" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#contact">​</a></h2>
<p>We are here to help! Whether you have questions, or issues or need assistance, our Slack channel is the perfect place for you. Click here to <a href="https://app.slack.com/client/T0471SNT5CZ/C06UZCXQLGP" target="_blank" rel="noopener noreferrer">join us</a> us.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-support-thisproject">👏 Support this&nbsp;project<a class="hash-link" aria-label="Direct link to 👏 Support this&nbsp;project" title="Direct link to 👏 Support this&nbsp;project" href="https://github.com/personal-blog/blog/cilium-eks-sveltos#-support-thisproject">​</a></h2>
<p>Every contribution counts! If you enjoyed this article, check out the Projectsveltos <a href="https://github.com/projectsveltos" target="_blank" rel="noopener noreferrer">GitHub repo</a>. You can <a href="https://github.com/projectsveltos" target="_blank" rel="noopener noreferrer">star 🌟 the project</a> if you find it helpful.</p>
<p>The GitHub repo is a great resource for getting started with the project. It contains the code, documentation, and many more examples.</p>
<p>Thanks for reading!</p>]]></content:encoded>
            <category>Cilium</category>
            <category>Open Source</category>
            <category>Kubernetes</category>
            <category>GitOps</category>
            <category>DevOps</category>
        </item>
        <item>
            <title><![CDATA[Welcome]]></title>
            <link>https://github.com/personal-blog/blog/welcome</link>
            <guid>https://github.com/personal-blog/blog/welcome</guid>
            <pubDate>Mon, 15 Jul 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[🌟 Welcome!]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-welcome">🌟 Welcome!<a class="hash-link" aria-label="Direct link to 🌟 Welcome!" title="Direct link to 🌟 Welcome!" href="https://github.com/personal-blog/blog/welcome#-welcome">​</a></h2>
<p>Hello and welcome to my blog! 🚀</p>
<p>Here, you will discover everything you need to know about open source tools, DevOps, and GitOps practices.</p>
<p>Dive in and let's explore together! 💡🔧</p>]]></content:encoded>
            <category>Hello</category>
        </item>
    </channel>
</rss>