<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Sveltos: Optimising Day-2 Operations with Cilium and Tetragon | Welcome to Eleni&#x27;s Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/personal-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://github.com/personal-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://github.com/personal-blog/blog/sveltos-cilium-tetragon-day2-operations"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Sveltos: Optimising Day-2 Operations with Cilium and Tetragon | Welcome to Eleni&#x27;s Blog"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-10-05T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/egrosdou01"><meta data-rh="true" property="article:tag" content="Sveltos,Cilium,Tetragon,Open Source,Kubernetes,GitOps,DevOps,2024"><link data-rh="true" rel="icon" href="https://github.com/egrosdou01.png"><link data-rh="true" rel="canonical" href="https://github.com/personal-blog/blog/sveltos-cilium-tetragon-day2-operations"><link data-rh="true" rel="alternate" href="https://github.com/personal-blog/blog/sveltos-cilium-tetragon-day2-operations" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/personal-blog/blog/sveltos-cilium-tetragon-day2-operations" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://github.com/personal-blog/blog/sveltos-cilium-tetragon-day2-operations","mainEntityOfPage":"https://github.com/personal-blog/blog/sveltos-cilium-tetragon-day2-operations","url":"https://github.com/personal-blog/blog/sveltos-cilium-tetragon-day2-operations","headline":"Sveltos: Optimising Day-2 Operations with Cilium and Tetragon","name":"Sveltos: Optimising Day-2 Operations with Cilium and Tetragon","description":"Introduction","datePublished":"2024-10-05T00:00:00.000Z","author":{"@type":"Person","name":"Eleni Grosdouli","description":"DevOps Consulting Engineer at Cisco Systems","url":"https://github.com/egrosdou01","image":"https://github.com/egrosdou01.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://github.com/personal-blog/blog","name":"Eleni Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/personal-blog/blog/rss.xml" title="Welcome to Eleni&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/personal-blog/blog/atom.xml" title="Welcome to Eleni&#39;s Blog Atom Feed"><link rel="stylesheet" href="/personal-blog/assets/css/styles.8e64e2c7.css">
<script src="/personal-blog/assets/js/runtime~main.2b7dd48f.js" defer="defer"></script>
<script src="/personal-blog/assets/js/main.4a8a7eaa.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/personal-blog/"><div class="navbar__logo"><img src="https://github.com/egrosdou01.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://github.com/egrosdou01.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">About</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/personal-blog/blog">Blog</a><a class="navbar__item navbar__link" href="/personal-blog/blog/tags">Tags</a><a class="navbar__item navbar__link" href="/personal-blog/talks">Talks</a><a class="navbar__item navbar__link" href="/personal-blog/favourites">Favourites</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/egrosdou01" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal-blog/blog/k8s-troubleshooting-insights-coredns">K8s Troubleshooting Insights: Looking into CoreDNS Issues</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations">Sveltos: Optimising Day-2 Operations with Cilium and Tetragon</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal-blog/blog/sveltos-introduction-to-tiers">Sveltos Tiers: Efficient Day-2 Operations and Targeted Updates</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal-blog/blog/ossummit-europe-2024">OSSummit Europe 2024</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal-blog/blog/civo-navigate-berlin-2024">Civo Navigate Berlin 2024</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal-blog/blog/opentofu-rke2-cilium-azure">OpenTofu: RKE2 Cluster with Cilium on Azure</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_xvU1">Sveltos: Optimising Day-2 Operations with Cilium and Tetragon</h1><div class="container_iJTo margin-vert--md"><time datetime="2024-10-05T00:00:00.000Z">October 5, 2024</time> Â· <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_q4o9"><div class="avatar margin-bottom--sm"><a href="https://github.com/egrosdou01" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/egrosdou01.png" alt="Eleni Grosdouli"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/egrosdou01" target="_blank" rel="noopener noreferrer"><span>Eleni Grosdouli</span></a></div><small class="avatar__subtitle">DevOps Consulting Engineer at Cisco Systems</small></div></div></div></div></header><div id="__blog-post-container" class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#introduction">â€‹</a></h2>
<p>How easy is it to handle <strong>Day-2</strong> operations with existing CI/CD tooling? <a href="https://github.com/projectsveltos" target="_blank" rel="noopener noreferrer">Sveltos</a> provides the ability to perform not only <strong>Day-1</strong> operations but also helps platform administrators, tenant administrators and other operators with <strong>Day-2</strong> operations. For example, we can use the <a href="https://github.com/projectsveltos/libsveltos/blob/main/api/v1beta1/healthcheck_type.go" target="_blank" rel="noopener noreferrer">HealthCheck</a> and the <a href="https://raw.githubusercontent.com/projectsveltos/libsveltos/main/api/v1beta1/clusterhealthcheck_type.go" target="_blank" rel="noopener noreferrer">ClusterHealthCheck</a> features to not only watch the health of a cluster but also collect information from the <code>managed</code> clusters and display them in the <code>management</code> cluster.</p>
<p>In today&#x27;s blog post, we will cover a way of deploying <a href="https://cilium.io/" target="_blank" rel="noopener noreferrer">Cilium</a> as our CNI alongside <a href="https://tetragon.io/" target="_blank" rel="noopener noreferrer">Cilium Tetragon</a> for observability. We will then continue with a simple <code>TracingPolicy</code> deployment to capture socket connections and then use Sveltos to display the tracing results back to the <code>management</code> cluster.</p>
<p>The goal of the demonstration is to showcase how Sveltos can be used for different Kubernetes cluster operations based on the use case at hand.</p>
<p><img decoding="async" loading="lazy" alt="title image reading &amp;quot;Sveltos Health Check&amp;quot;" src="/personal-blog/assets/images/Sveltos_Cilium_Tetragon_HealthCheck-d992c3bba4b4e87aa2c374f5216ba190.jpg" width="5065" height="3158" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-setup">Lab Setup<a class="hash-link" aria-label="Direct link to Lab Setup" title="Direct link to Lab Setup" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#lab-setup">â€‹</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+-------------------+--------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Cluster Name  |        Type       |         Version          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+-------------------+--------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      mgmt       |   Mgmt Cluster    |      v1.28.9+rke2r1      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| tetragon-test   |  Managed Cluster  |      v1.29.2+k3s1        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+-------------------+--------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  Deployment  |        Version     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    Cilium    |       v1.16.1      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Tetragon   |       v1.2.0       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  sveltosctl  |       v0.37.0      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------+---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-resources">GitHub Resources<a class="hash-link" aria-label="Direct link to GitHub Resources" title="Direct link to GitHub Resources" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#github-resources">â€‹</a></h2>
<p>The YAML definition files are located <a href="https://github.com/egrosdou01/sveltos-demo-resources/tree/main/day-2-operations/sveltos-cilium-tetragon" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#prerequisites">â€‹</a></h2>
<p>To follow along, ensure the below are satisfied.</p>
<ol>
<li>A management cluster with Sveltos installed</li>
<li>kubectl installed</li>
<li>sveltosctl installed</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If you are unaware of installing Sveltos in a Kubernetes cluster, follow the instructions mentioned <a href="https://projectsveltos.github.io/sveltos/getting_started/install/install/" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-cluster-registration-withsveltos">Step 1: Cluster Registration withÂ Sveltos<a class="hash-link" aria-label="Direct link to Step 1: Cluster Registration withÂ Sveltos" title="Direct link to Step 1: Cluster Registration withÂ Sveltos" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#step-1-cluster-registration-withsveltos">â€‹</a></h2>
<p>Once the Kubernetes cluster is ready, we can continue with the Sveltos registration. To do that, we will utilise <code>sveltosctl</code>. The <code>sveltosctl</code> can be downloaded <a href="https://github.com/projectsveltos/sveltosctl/releases" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-registration">Example Registration<a class="hash-link" aria-label="Direct link to Example Registration" title="Direct link to Example Registration" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#example-registration">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sveltosctl register cluster --namespace=test --cluster=tetragon-test \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --kubeconfig=/home/test/tetragon-test.yaml \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --labels=env=test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The cluster above will be registered with Sveltos on the mentioned <strong>namespace</strong>, and <strong>name</strong>, and will attach the cluster labels to perform different deployment versions.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If the namespace does not exist in the management cluster, the command will fail with the namespace not found error. Ensure the defined namespace exists in the cluster before registration.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="validation">Validation<a class="hash-link" aria-label="Direct link to Validation" title="Direct link to Validation" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#validation">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ export KUBECONFIG=&lt;Sveltos managament cluster&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get sveltoscluster -A --show-labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAMESPACE   NAME          READY   VERSION          LABELS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mgmt        mgmt            true    v1.28.9+rke2r1   projectsveltos.io/k8s-version=v1.28.9,sveltos-agent=present</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test        tetragon-test   true    v1.29.2+k3s1     env=test,projectsveltos.io/k8s-version=v1.29.2,sveltos-agent=present</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Ensure the labels set are correct. We will use them at a later step.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-custom-configmap-cilium-tetragon-deployment">Step 2: Custom ConfigMap, Cilium, Tetragon Deployment<a class="hash-link" aria-label="Direct link to Step 2: Custom ConfigMap, Cilium, Tetragon Deployment" title="Direct link to Step 2: Custom ConfigMap, Cilium, Tetragon Deployment" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#step-2-custom-configmap-cilium-tetragon-deployment">â€‹</a></h2>
<p>As a first step, we will deploy <strong>Cilium</strong> and <strong>Cilium Tetragon</strong> to the clusters with the label set to <code>env:test</code>. Then, we will deploy a <code>ConfigMap</code> on the <code>management</code> cluster and allow Sveltos to deploy a <code>TracingPolicy</code> alongside a <code>CronJob</code> that polls tracing events every 2 minutes from the targeted <code>managed</code> cluster.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clusterprofile---cilium-tetragon-and-configmap">ClusterProfile - Cilium, Tetragon, and ConfigMap<a class="hash-link" aria-label="Direct link to ClusterProfile - Cilium, Tetragon, and ConfigMap" title="Direct link to ClusterProfile - Cilium, Tetragon, and ConfigMap" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#clusterprofile---cilium-tetragon-and-configmap">â€‹</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config.projectsveltos.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterProfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tetragon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">clusterSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">helmCharts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">chartName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cilium/cilium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">chartVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1.16.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">helmChartAction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">releaseName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cilium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">releaseNamespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repositoryName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cilium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repositoryURL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//helm.cilium.io/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">chartName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cilium/tetragon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">chartVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1.2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">helmChartAction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">releaseName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tetragon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">releaseNamespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repositoryName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tetragon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repositoryURL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//helm.cilium.io/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">policyRefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tetragon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">policy</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">socket</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConfigMap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sveltos follows the top-down approach when it comes to add-on and application deployment. First, Cilium will get deployed as our CNI. Next, then <strong>Tetragon</strong> and afterwards, we proceed with the deployment of a <code>ConfigMap</code> with the name <code>tetragon-policy-socket-log</code> which has already been deployed in the <code>management</code> cluster.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>A copy of the <code>ConfigMap</code> YAML definition is located <a href="https://github.com/egrosdou01/sveltos-demo-resources/blob/main/day-2-operations/sveltos-cilium-tetragon/env-test/tetragon_configmap.yaml" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-configmap-and-clusterprofile---management-cluster">Deploy ConfigMap and ClusterProfile - Management Cluster<a class="hash-link" aria-label="Direct link to Deploy ConfigMap and ClusterProfile - Management Cluster" title="Direct link to Deploy ConfigMap and ClusterProfile - Management Cluster" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#deploy-configmap-and-clusterprofile---management-cluster">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ export KUBECONFIG=&lt;Sveltos managament cluster&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply -f tetragon_cm.yaml,clusterprofile_tetragon.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="validation---management-cluster">Validation - Management Cluster<a class="hash-link" aria-label="Direct link to Validation - Management Cluster" title="Direct link to Validation - Management Cluster" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#validation---management-cluster">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./sveltosctl show addons                                         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+----------------------------------------------+-------------+-------------------------------+---------+--------------------------------+-------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      CLUSTER       |                RESOURCE TYPE                 |  NAMESPACE  |             NAME              | VERSION |              TIME              |              PROFILES               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+----------------------------------------------+-------------+-------------------------------+---------+--------------------------------+-------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test/tetragon-test | helm chart                                   | kube-system | cilium                        | 1.16.1  | 2024-10-06 09:28:12 +0200 CEST | ClusterProfile/tetragon-test-deploy |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test/tetragon-test | helm chart                                   | kube-system | tetragon                      | 1.2.0   | 2024-10-06 09:28:15 +0200 CEST | ClusterProfile/tetragon-test-deploy |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test/tetragon-test | rbac.authorization.k8s.io:ClusterRoleBinding |             | tetragon-cluster-role-binding | N/A     | 2024-10-06 09:28:12 +0200 CEST | ClusterProfile/tetragon-test-deploy |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test/tetragon-test | batch:CronJob                                | default     | tetragon-log-fetcher          | N/A     | 2024-10-06 09:28:12 +0200 CEST | ClusterProfile/tetragon-test-deploy |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test/tetragon-test | cilium.io:TracingPolicy                      |             | networking                    | N/A     | 2024-10-06 09:28:12 +0200 CEST | ClusterProfile/tetragon-test-deploy |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test/tetragon-test | :ServiceAccount                              | default     | tetragon-sa                   | N/A     | 2024-10-06 09:28:12 +0200 CEST | ClusterProfile/tetragon-test-deploy |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test/tetragon-test | rbac.authorization.k8s.io:ClusterRole        |             | tetragon-cluster-role         | N/A     | 2024-10-06 09:28:12 +0200 CEST | ClusterProfile/tetragon-test-deploy |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+----------------------------------------------+-------------+-------------------------------+---------+--------------------------------+-------------------------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="validation---managed-cluster">Validation - Managed Cluster<a class="hash-link" aria-label="Direct link to Validation - Managed Cluster" title="Direct link to Validation - Managed Cluster" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#validation---managed-cluster">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods -n kube-system | grep -E &quot;cilium|tetragon&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-operator-8547744bd7-qhl7r     1/1     Running   0          4m30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-operator-8547744bd7-m26lh     1/1     Running   0          4m30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tetragon-mln8g                       2/2     Running   0          4m29s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tetragon-c7gwj                       2/2     Running   0          4m29s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tetragon-tjx54                       2/2     Running   0          4m29s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-g7ftd                         1/1     Running   0          4m30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-pv9gj                         1/1     Running   0          4m30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-9cr4l                         1/1     Running   0          4m30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-envoy-9kjnv                   1/1     Running   0          4m30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-envoy-fpqkl                   1/1     Running   0          4m30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-envoy-25gvv                   1/1     Running   0          4m30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tetragon-operator-55c555fcf4-s5mvs   1/1     Running   0          4m29s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get cronjobs,jobs,pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                 SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cronjob.batch/tetragon-log-fetcher   */2 * * * *   False     0        98s             5m26s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                      COMPLETIONS   DURATION   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">job.batch/install-traefik2-nodeport-te    1/1           11s        47h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">job.batch/tetragon-log-fetcher-28803330   1/1           10s        3m38s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">job.batch/tetragon-log-fetcher-28803332   1/1           9s         98s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                      READY   STATUS      RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/install-traefik2-nodeport-te-zrh57    0/1     Completed   0          47h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/tetragon-log-fetcher-28803330-wpl9r   0/1     Completed   0          3m38s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/tetragon-log-fetcher-28803332-r7q5v   0/1     Completed   0          98s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Based on the output above, we have deployed <strong>Cilium</strong>, <strong>Tetragon</strong> and a <strong>CronJob</strong> to collect Tetragon logs based on a tracing policy every 2 minutes with a timeout of 5 sec. ðŸŽ‰ We can proceed further and use the Sveltos <code>ClucterHealthCheck</code> and <code>HealthCheck</code> to collect the data of the newly created <code>ConfiMap</code> in the managed cluster.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If the defined <code>ConfigMap</code> or <code>CronJob</code> does not fit your needs, feel free to update the YAML definitions based on your liking.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-deploy-clusterhealthcheck-and-healthcheck">Step 3: Deploy ClusterHealthCheck and HealthCheck<a class="hash-link" aria-label="Direct link to Step 3: Deploy ClusterHealthCheck and HealthCheck" title="Direct link to Step 3: Deploy ClusterHealthCheck and HealthCheck" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#step-3-deploy-clusterhealthcheck-and-healthcheck">â€‹</a></h2>
<p>To be able to collect resources from the Sveltos managed cluster, we will use a new YAML definition to collect the data from the <code>ConfigMap</code> with the name <code>tetragon-logs</code>.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The <code>ConfigMap tetragon-logs</code> is <strong>created</strong> and <strong>patched</strong> with a periodic execution of <code>Jobs</code> mentioned in Step 2.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="healthcheck-and-clusterhealthcheck-defintion">HealthCheck and ClusterHealthCheck Defintion<a class="hash-link" aria-label="Direct link to HealthCheck and ClusterHealthCheck Defintion" title="Direct link to HealthCheck and ClusterHealthCheck Defintion" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#healthcheck-and-clusterhealthcheck-defintion">â€‹</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Collect the resource of the ConfigMap with the name `tetragon-logs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lib.projectsveltos.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HealthCheck</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tetragon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fetcher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">collectResources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resourceSelectors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">group</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ConfigMap&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tetragon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">evaluateHealth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    function evaluate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      local statuses = {}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      for _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">resource in ipairs(resources) do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        status = &quot;Degraded&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        table.insert(statuses</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">resource=resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> status = status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message = resource.data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;tetragon-logs.txt&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      local hs = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if </span><span class="token comment" style="color:#999988;font-style:italic">#statuses &gt; 0 then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hs.resources = statuses </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return hs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Get the ConfigMap data and send it to the management cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lib.projectsveltos.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterHealthCheck</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tetragon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fetcher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">clusterSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">livenessChecks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tetragon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fetcher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HealthCheck</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">livenessSourceRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HealthCheck</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lib.projectsveltos.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tetragon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fetcher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">notifications</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KubernetesEvent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-healthcheck-and-clusterhealthcheck---management-cluster">Deploy HealthCheck and ClusterHealthCheck - Management Cluster<a class="hash-link" aria-label="Direct link to Deploy HealthCheck and ClusterHealthCheck - Management Cluster" title="Direct link to Deploy HealthCheck and ClusterHealthCheck - Management Cluster" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#deploy-healthcheck-and-clusterhealthcheck---management-cluster">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ export KUBECONFIG=&lt;Sveltos managament cluster&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply -f tetragon_healthcheck_logs.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="validation---management-cluster-1">Validation - Management Cluster<a class="hash-link" aria-label="Direct link to Validation - Management Cluster" title="Direct link to Validation - Management Cluster" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#validation---management-cluster-1">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./sveltosctl show resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+---------------------+-----------+---------------+--------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      CLUSTER       |         GVK         | NAMESPACE |     NAME      |                                                   MESSAGE                                                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+---------------------+-----------+---------------+--------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test/tetragon-test | /v1, Kind=ConfigMap | default   | tetragon-logs | ðŸ”Œ connect kube-system/coredns-6799fbcd5-4bv5r /coredns tcp 127.0.0.1:35846 -&gt;                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                    |                     |           |               | 127.0.0.1:8080 ðŸ§¹ close   kube-system/coredns-6799fbcd5-4bv5r /coredns tcp 127.0.0.1:35846                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                    |                     |           |               | -&gt; 127.0.0.1:8080 ðŸ§¹ close   kube-system/coredns-6799fbcd5-4bv5r /coredns tcp 127.0.0.1:8080                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                    |                     |           |               | -&gt; 127.0.0.1:35846 ðŸ”Œ connect kube-system/coredns-6799fbcd5-4bv5r /coredns tcp                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                    |                     |           |               | 127.0.0.1:35852 -&gt; 127.0.0.1:8080 ðŸ§¹ close   kube-system/coredns-6799fbcd5-4bv5r /coredns tcp                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                    |                     |           |               | 127.0.0.1:35852 -&gt; 127.0.0.1:8080 ðŸ§¹ close   kube-system/coredns-6799fbcd5-4bv5r /coredns tcp                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                    |                     |           |               | 127.0.0.1:8080 -&gt; 127.0.0.1:35852 ðŸ”Œ connect k3s-tetragon-9ab2-92fa7d-node-pool-df07-7inhp                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                    |                     |           |               | /var/lib/rancher/k3s/data/7d0aa19ffc230d4322f04d1ae8783e54ce189dfc4cbfa0a6afcdcabec2346d0c/bin/k3s           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+---------------------+-----------+---------------+--------------------------------------------------------------------------------------------------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>From the output above, we see the logs collected from the Tetragon TracingPolicy coming from a <code>managed</code> cluster and making them available in a <code>management</code> cluster! Cool, right? The same approach can be used with different data located in the <code>managed</code> clusters. A post written by Gianluca outlining the collection of <code>kube-bench</code> scanning results can be found <a href="https://itnext.io/ensurincis-benchmark-compliance-across-multiple-kubernetes-clusters-dd544682e786" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sveltos-for-day-2-operations-benefits">Sveltos for Day-2 Operations Benefits<a class="hash-link" aria-label="Direct link to Sveltos for Day-2 Operations Benefits" title="Direct link to Sveltos for Day-2 Operations Benefits" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#sveltos-for-day-2-operations-benefits">â€‹</a></h2>
<p>Sveltos allows users to deploy the required add-on and deployments to a fleet of clusters while allowing platform administrators and operators to <strong>enhance</strong> the <strong>security posture</strong> and <strong>observability</strong> of the clusters in a simple and meaningful way. Use the Sveltos <code>Event Framework</code>, <code>Tiers</code>, <code>ClusterHealthCheck</code>, and <code>HealthCheck</code> features to enhance the posture of different platforms!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusions">Conclusions<a class="hash-link" aria-label="Direct link to Conclusions" title="Direct link to Conclusions" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#conclusions">â€‹</a></h2>
<p>In a few minutes â³, with minimal configuration effort and following the GitOps approach, we deployed Cilium as our CNI, Cilium Tetragon for observability alongside polling and displaying of critical tracing results to the management cluster painlessly! ðŸŽ‰</p>
<p>In the next blog posts, we will touch on topics around Day-2 operations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#resources">â€‹</a></h2>
<ul>
<li><strong>Cilium Labs</strong>: <a href="https://isovalent.com/resource-library/labs/" target="_blank" rel="noopener noreferrer">https://isovalent.com/resource-library/labs/</a></li>
<li><strong>Tetragon - Getting Started Lab</strong>: <a href="https://isovalent.com/labs/tetragon-getting-started/" target="_blank" rel="noopener noreferrer">https://isovalent.com/labs/tetragon-getting-started/</a></li>
<li><strong>Sveltos ClusterHealthCheck/HealthCheck</strong>: <a href="https://projectsveltos.github.io/sveltos/observability/notifications/#example-configmap-healthcheck" target="_blank" rel="noopener noreferrer">https://projectsveltos.github.io/sveltos/observability/notifications/#example-configmap-healthcheck</a></li>
<li><strong>Sveltos Event Framework</strong>: <a href="https://projectsveltos.github.io/sveltos/events/addon_event_deployment/" target="_blank" rel="noopener noreferrer">https://projectsveltos.github.io/sveltos/events/addon_event_deployment/</a></li>
<li><strong>Sveltos Tiers</strong>: <a href="https://projectsveltos.github.io/sveltos/deployment_order/tiers/" target="_blank" rel="noopener noreferrer">https://projectsveltos.github.io/sveltos/deployment_order/tiers/</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ï¸-contact">âœ‰ï¸ Contact<a class="hash-link" aria-label="Direct link to âœ‰ï¸ Contact" title="Direct link to âœ‰ï¸ Contact" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#ï¸-contact">â€‹</a></h2>
<p>We are here to help! Whether you have questions, or issues or need assistance, our Slack channel is the perfect place for you. Click here to <a href="https://app.slack.com/client/T0471SNT5CZ/C06UZCXQLGP" target="_blank" rel="noopener noreferrer">join us</a> us.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-support-thisproject">ðŸ‘ Support thisÂ project<a class="hash-link" aria-label="Direct link to ðŸ‘ Support thisÂ project" title="Direct link to ðŸ‘ Support thisÂ project" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#-support-thisproject">â€‹</a></h2>
<p>Every contribution counts! If you enjoyed this article, check out the Projectsveltos <a href="https://github.com/projectsveltos" target="_blank" rel="noopener noreferrer">GitHub repo</a>. You can <a href="https://github.com/projectsveltos" target="_blank" rel="noopener noreferrer">star ðŸŒŸ the project</a> if you find it helpful.</p>
<p>The GitHub repo is a great resource for getting started with the project. It contains the code, documentation, and many more examples.</p>
<p>Thanks for reading!</p></div><div class="blog-post-spacing"></div><div class="social-share-container"><div class="social-share"><p class="shareText_x93L">SHARE</p><button class="react-share__ShareButton shareButton_AVfu" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="25" height="25"><circle cx="32" cy="32" r="32" fill="#0077B5"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button class="react-share__ShareButton shareButton_AVfu" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="25" height="25"><circle cx="32" cy="32" r="32" fill="#000000"></circle><path d="M 41.116 18.375 h 4.962 l -10.8405 12.39 l 12.753 16.86 H 38.005 l -7.821 -10.2255 L 21.235 47.625 H 16.27 l 11.595 -13.2525 L 15.631 18.375 H 25.87 l 7.0695 9.3465 z m -1.7415 26.28 h 2.7495 L 24.376 21.189 H 21.4255 z" fill="white"></path></svg></button><button class="react-share__ShareButton shareButton_AVfu" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="25" height="25"><circle cx="32" cy="32" r="32" fill="#FF5700"></circle><path d="M 53.34375 32 C 53.277344 30.160156 52.136719 28.53125 50.429688 27.839844 C 48.722656 27.148438 46.769531 27.523438 45.441406 28.800781 C 41.800781 26.324219 37.519531 24.957031 33.121094 24.863281 L 35.199219 14.878906 L 42.046875 16.320312 C 42.214844 17.882812 43.496094 19.09375 45.066406 19.171875 C 46.636719 19.253906 48.03125 18.183594 48.359375 16.644531 C 48.6875 15.105469 47.847656 13.558594 46.382812 12.992188 C 44.914062 12.425781 43.253906 13.007812 42.464844 14.367188 L 34.625 12.800781 C 34.363281 12.742188 34.09375 12.792969 33.871094 12.9375 C 33.648438 13.082031 33.492188 13.308594 33.441406 13.566406 L 31.070312 24.671875 C 26.617188 24.738281 22.277344 26.105469 18.59375 28.609375 C 17.242188 27.339844 15.273438 26.988281 13.570312 27.707031 C 11.863281 28.429688 10.746094 30.089844 10.71875 31.941406 C 10.691406 33.789062 11.757812 35.484375 13.441406 36.257812 C 13.402344 36.726562 13.402344 37.195312 13.441406 37.664062 C 13.441406 44.832031 21.792969 50.65625 32.097656 50.65625 C 42.398438 50.65625 50.753906 44.832031 50.753906 37.664062 C 50.789062 37.195312 50.789062 36.726562 50.753906 36.257812 C 52.363281 35.453125 53.371094 33.800781 53.34375 32 Z M 21.34375 35.199219 C 21.34375 33.433594 22.777344 32 24.542969 32 C 26.3125 32 27.742188 33.433594 27.742188 35.199219 C 27.742188 36.96875 26.3125 38.398438 24.542969 38.398438 C 22.777344 38.398438 21.34375 36.96875 21.34375 35.199219 Z M 39.9375 44 C 37.664062 45.710938 34.871094 46.582031 32.03125 46.464844 C 29.191406 46.582031 26.398438 45.710938 24.128906 44 C 23.847656 43.65625 23.871094 43.15625 24.183594 42.839844 C 24.5 42.527344 25 42.503906 25.34375 42.785156 C 27.269531 44.195312 29.617188 44.90625 32 44.800781 C 34.386719 44.929688 36.746094 44.242188 38.6875 42.847656 C 39.042969 42.503906 39.605469 42.511719 39.953125 42.863281 C 40.296875 43.21875 40.289062 43.785156 39.9375 44.128906 Z M 39.359375 38.527344 C 37.59375 38.527344 36.160156 37.09375 36.160156 35.328125 C 36.160156 33.5625 37.59375 32.128906 39.359375 32.128906 C 41.128906 32.128906 42.558594 33.5625 42.558594 35.328125 C 42.59375 36.203125 42.269531 37.054688 41.65625 37.6875 C 41.046875 38.316406 40.203125 38.664062 39.328125 38.65625 Z M 39.359375 38.527344" fill="white"></path></svg></button><button class="react-share__ShareButton shareButton_AVfu" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="25" height="25"><circle cx="32" cy="32" r="32" fill="#7f7f7f"></circle><path d="M17,22v20h30V22H17z M41.1,25L32,32.1L22.9,25H41.1z M20,39V26.6l12,9.3l12-9.3V39H20z" fill="white"></path></svg></button></div></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a title="Open source project Sveltos" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/sveltos">Sveltos</a></li><li class="tag_QGVx"><a title="eBPF-based Networking, Security, and Observability for Kubernetes" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/cilium">Cilium</a></li><li class="tag_QGVx"><a title="Cilium Tetragon - powerful real-time, eBPF-based Security Observability and Runtime Enforcement" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/tetragon">Tetragon</a></li><li class="tag_QGVx"><a title="Open source software" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/open-source">Open Source</a></li><li class="tag_QGVx"><a title="Container orchestration platform for automating application deployment, scaling, and management" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/kubernetes">Kubernetes</a></li><li class="tag_QGVx"><a title="Operational framework that uses Git as a single source of truth for declarative infrastructure and applications" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/gitops">GitOps</a></li><li class="tag_QGVx"><a title="Set of practices that combines software development and IT operations" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/devops">DevOps</a></li><li class="tag_QGVx"><a title="The year the post went online" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/2024">2024</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/personal-blog/blog/k8s-troubleshooting-insights-coredns"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">K8s Troubleshooting Insights: Looking into CoreDNS Issues</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/personal-blog/blog/sveltos-introduction-to-tiers"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Sveltos Tiers: Efficient Day-2 Operations and Targeted Updates</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#introduction">Introduction</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#lab-setup">Lab Setup</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#github-resources">GitHub Resources</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#prerequisites">Prerequisites</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#step-1-cluster-registration-withsveltos">Step 1: Cluster Registration withÂ Sveltos</a><ul><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#example-registration">Example Registration</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#validation">Validation</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#step-2-custom-configmap-cilium-tetragon-deployment">Step 2: Custom ConfigMap, Cilium, Tetragon Deployment</a><ul><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#clusterprofile---cilium-tetragon-and-configmap">ClusterProfile - Cilium, Tetragon, and ConfigMap</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#deploy-configmap-and-clusterprofile---management-cluster">Deploy ConfigMap and ClusterProfile - Management Cluster</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#validation---management-cluster">Validation - Management Cluster</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#validation---managed-cluster">Validation - Managed Cluster</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#step-3-deploy-clusterhealthcheck-and-healthcheck">Step 3: Deploy ClusterHealthCheck and HealthCheck</a><ul><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#healthcheck-and-clusterhealthcheck-defintion">HealthCheck and ClusterHealthCheck Defintion</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#deploy-healthcheck-and-clusterhealthcheck---management-cluster">Deploy HealthCheck and ClusterHealthCheck - Management Cluster</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#validation---management-cluster-1">Validation - Management Cluster</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#sveltos-for-day-2-operations-benefits">Sveltos for Day-2 Operations Benefits</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#conclusions">Conclusions</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#resources">Resources</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#ï¸-contact">âœ‰ï¸ Contact</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations#-support-thisproject">ðŸ‘ Support thisÂ project</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/personal-blog/">About me</a></li></ul></div><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://linkedin.com/in/eleni-grosdouli-85a1a5116" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/egrosdou01" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://medium.com/@eleni.grosdouli" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/personal-blog/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 Eleni Grosdouli Blog</div></div></div></footer></div>
</body>
</html>