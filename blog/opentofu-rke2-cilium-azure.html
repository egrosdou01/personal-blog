<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">OpenTofu: RKE2 Cluster with Cilium on Azure | Welcome to Eleni&#x27;s Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/personal-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://github.com/personal-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://github.com/personal-blog/blog/opentofu-rke2-cilium-azure"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="OpenTofu: RKE2 Cluster with Cilium on Azure | Welcome to Eleni&#x27;s Blog"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-08-21T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/egrosdou01"><meta data-rh="true" property="article:tag" content="OpenTofu,Cilium,RKE2,Azure,Open Source,Kubernetes,GitOps,DevOps,2024"><link data-rh="true" rel="icon" href="https://github.com/egrosdou01.png"><link data-rh="true" rel="canonical" href="https://github.com/personal-blog/blog/opentofu-rke2-cilium-azure"><link data-rh="true" rel="alternate" href="https://github.com/personal-blog/blog/opentofu-rke2-cilium-azure" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/personal-blog/blog/opentofu-rke2-cilium-azure" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://github.com/personal-blog/blog/opentofu-rke2-cilium-azure","mainEntityOfPage":"https://github.com/personal-blog/blog/opentofu-rke2-cilium-azure","url":"https://github.com/personal-blog/blog/opentofu-rke2-cilium-azure","headline":"OpenTofu: RKE2 Cluster with Cilium on Azure","name":"OpenTofu: RKE2 Cluster with Cilium on Azure","description":"Introduction","datePublished":"2024-08-21T00:00:00.000Z","author":{"@type":"Person","name":"Eleni Grosdouli","description":"DevOps Consulting Engineer at Cisco Systems","url":"https://github.com/egrosdou01","image":"https://github.com/egrosdou01.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://github.com/personal-blog/blog","name":"Eleni Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/personal-blog/blog/rss.xml" title="Welcome to Eleni&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/personal-blog/blog/atom.xml" title="Welcome to Eleni&#39;s Blog Atom Feed"><link rel="stylesheet" href="/personal-blog/assets/css/styles.8e64e2c7.css">
<script src="/personal-blog/assets/js/runtime~main.2b7dd48f.js" defer="defer"></script>
<script src="/personal-blog/assets/js/main.7dca580e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/personal-blog/"><div class="navbar__logo"><img src="https://github.com/egrosdou01.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://github.com/egrosdou01.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">About</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/personal-blog/blog">Blog</a><a class="navbar__item navbar__link" href="/personal-blog/blog/tags">Tags</a><a class="navbar__item navbar__link" href="/personal-blog/talks">Talks</a><a class="navbar__item navbar__link" href="/personal-blog/favourites">Favourites</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/egrosdou01" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal-blog/blog/k8s-troubleshooting-insights-coredns">K8s Troubleshooting Insights: Looking into CoreDNS Issues</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal-blog/blog/sveltos-cilium-tetragon-day2-operations">Sveltos: Optimising Day-2 Operations with Cilium and Tetragon</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal-blog/blog/sveltos-introduction-to-tiers">Sveltos Tiers: Efficient Day-2 Operations and Targeted Updates</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal-blog/blog/ossummit-europe-2024">OSSummit Europe 2024</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/personal-blog/blog/civo-navigate-berlin-2024">Civo Navigate Berlin 2024</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/personal-blog/blog/opentofu-rke2-cilium-azure">OpenTofu: RKE2 Cluster with Cilium on Azure</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_xvU1">OpenTofu: RKE2 Cluster with Cilium on Azure</h1><div class="container_iJTo margin-vert--md"><time datetime="2024-08-21T00:00:00.000Z">August 21, 2024</time> Â· <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_q4o9"><div class="avatar margin-bottom--sm"><a href="https://github.com/egrosdou01" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/egrosdou01.png" alt="Eleni Grosdouli"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/egrosdou01" target="_blank" rel="noopener noreferrer"><span>Eleni Grosdouli</span></a></div><small class="avatar__subtitle">DevOps Consulting Engineer at Cisco Systems</small></div></div></div></div></header><div id="__blog-post-container" class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" href="/personal-blog/blog/opentofu-rke2-cilium-azure#introduction">â€‹</a></h2>
<p>In a <a href="/personal-blog/blog/rancher-rke2-cilium-azure">previous post</a>, we covered how to create an <a href="https://docs.rke2.io/" target="_blank" rel="noopener noreferrer">RKE2</a> cluster on <a href="https://azure.microsoft.com/en-us/get-started" target="_blank" rel="noopener noreferrer">Azure Cloud</a> using the <a href="https://azure.microsoft.com/en-us/free#all-free-services" target="_blank" rel="noopener noreferrer">cloud-free credits</a> from the <strong>Rancher UI</strong>. As this is a convenient approach to get started with Rancher, in today&#x27;s post, we will demonstrate how to use <a href="https://opentofu.org/" target="_blank" rel="noopener noreferrer">OpenTofu</a> to automate the deployment.</p>
<p><code>OpenTofu</code> is a fork of <a href="https://www.terraform.io/" target="_blank" rel="noopener noreferrer">Terraform</a>. It is an open-source project, community-driven, and managed by the Linux Foundation. If you want to get familiar with what <code>OpenTofu</code> is and how to get started, check out the link <a href="https://opentofu.org/docs/intro/core-workflow/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>Additionally, we will demonstrate how easy it is to customise the <a href="https://docs.cilium.io/en/stable/" target="_blank" rel="noopener noreferrer">Cilium</a> configuration and enable <a href="https://kube-vip.io/" target="_blank" rel="noopener noreferrer">kube-vip</a> for LoadBalancer services from the HCL (HashiCorp Configuration Language) definition.</p>
<p><img decoding="async" loading="lazy" alt="title image reading &amp;quot;OpenTofu Rancher RKE2 Cluster on Azure&amp;quot;" src="/personal-blog/assets/images/openTofu_rancher_intro_image-d89b7d976207b64e2eaa5b79d0cbf34e.jpg" width="6907" height="2316" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-setup">Lab Setup<a class="hash-link" aria-label="Direct link to Lab Setup" title="Direct link to Lab Setup" href="/personal-blog/blog/opentofu-rke2-cilium-azure#lab-setup">â€‹</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------------------+------------------+----------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|        Cluster Name         |       Type       |       Version        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------------------+------------------+----------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|          Rancher            |   k3s cluster    |    v1.28.7+k3s1      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Downstream RKE2 cluster     |       RKE2       |  v1.28.11+rke2r1     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------------------+------------------+----------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    Deployment     | Version  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      Cilium       | 1.15.500 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      OpenTofu     | v1.8.1   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" href="/personal-blog/blog/opentofu-rke2-cilium-azure#prerequisites">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rancher-server">Rancher Server<a class="hash-link" aria-label="Direct link to Rancher Server" title="Direct link to Rancher Server" href="/personal-blog/blog/opentofu-rke2-cilium-azure#rancher-server">â€‹</a></h3>
<p>We do not concentrate on installing <code>Rancher</code>. If you are unsure how to install Rancher, take a look at the official documentation <a href="https://ranchermanager.docs.rancher.com/getting-started/quick-start-guides" target="_blank" rel="noopener noreferrer">here</a> or go through the guide I created a couple of weeks back found <a href="https://medium.com/@eleni.grosdouli/rancher-on-eks-with-nginx-ingress-and-lets-encrypt-4f041fc1adae" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="azure-free-credits">Azure Free Credits<a class="hash-link" aria-label="Direct link to Azure Free Credits" title="Direct link to Azure Free Credits" href="/personal-blog/blog/opentofu-rke2-cilium-azure#azure-free-credits">â€‹</a></h3>
<p>For this demonstration, we will use the Azure <a href="https://azure.microsoft.com/en-us/free" target="_blank" rel="noopener noreferrer">free credits</a> offering. The approach taken allows readers to understand how to set up the Azure cloud environment to perform RKE2 deployments with Rancher without spending money outside the free-credits offering.</p>
<p>Ensure the below are satisfied.</p>
<ol>
<li>Helm CLI installed (Optional Step)</li>
<li>kubectl installed</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-opentofu">Install OpenTofu<a class="hash-link" aria-label="Direct link to Install OpenTofu" title="Direct link to Install OpenTofu" href="/personal-blog/blog/opentofu-rke2-cilium-azure#install-opentofu">â€‹</a></h3>
<p>There is a wide variety of options provided to install <code>OpenTofu</code>. To follow along, check out the <a href="https://opentofu.org/docs/intro/install/" target="_blank" rel="noopener noreferrer">link</a> and install <code>OpenTofu</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="validation">Validation<a class="hash-link" aria-label="Direct link to Validation" title="Direct link to Validation" href="/personal-blog/blog/opentofu-rke2-cilium-azure#validation">â€‹</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tofu version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OpenTofu v1.8.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">on darwin_arm64</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-0-pre-work">Step 0: Pre-work<a class="hash-link" aria-label="Direct link to Step 0: Pre-work" title="Direct link to Step 0: Pre-work" href="/personal-blog/blog/opentofu-rke2-cilium-azure#step-0-pre-work">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-01-familiarise-with-opentofu-registry">Step 0.1: Familiarise with OpenTofu Registry<a class="hash-link" aria-label="Direct link to Step 0.1: Familiarise with OpenTofu Registry" title="Direct link to Step 0.1: Familiarise with OpenTofu Registry" href="/personal-blog/blog/opentofu-rke2-cilium-azure#step-01-familiarise-with-opentofu-registry">â€‹</a></h3>
<p>As with the Terraform registry, the <code>OpenTofu</code> registry is a centralised service for <strong>distributing</strong> and <strong>managing</strong> providers/modules. Users can <strong>share</strong>, <strong>discover</strong>, and <strong>consume</strong> reusable infrastructure modules and providers.</p>
<p>A list of the available providers/modules is located <a href="https://github.com/opentofu/registry/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>The <code>rancher2</code> provider is supported by OpenTofu. The details can be found <a href="https://github.com/opentofu/registry/tree/main/providers/r/rancher" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-02-familiarise-with-rancher2-provider">Step 0.2: Familiarise with Rancher2 Provider<a class="hash-link" aria-label="Direct link to Step 0.2: Familiarise with Rancher2 Provider" title="Direct link to Step 0.2: Familiarise with Rancher2 Provider" href="/personal-blog/blog/opentofu-rke2-cilium-azure#step-02-familiarise-with-rancher2-provider">â€‹</a></h3>
<p>Before we even begin with the actual coding, it is a nice opportunity to familiarise with the <a href="https://search.opentofu.org/provider/opentofu/rancher2/v4.1.0" target="_blank" rel="noopener noreferrer">Rancher2 provider</a>.</p>
<p><img decoding="async" loading="lazy" alt="title image reading &amp;quot;Rancher2 Terraform Provider&amp;quot;" src="/personal-blog/assets/images/rancher2_tf_provider-9d0f69806f1f35bebe06e0d0199cc865.png" width="3454" height="2076" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Check out the example sections of the resources available and the supported Cloud providers.</p></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Be mindful this is an alpha preview of the OpenTofu Registry UI. If you encounter any issues, report them <a href="https://github.com/opentofu/registry-ui/issues" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-03-choose-integrated-development-environment-ide">Step 0.3: Choose Integrated Development Environment (IDE)<a class="hash-link" aria-label="Direct link to Step 0.3: Choose Integrated Development Environment (IDE)" title="Direct link to Step 0.3: Choose Integrated Development Environment (IDE)" href="/personal-blog/blog/opentofu-rke2-cilium-azure#step-03-choose-integrated-development-environment-ide">â€‹</a></h3>
<p>As with any other project, we will use <a href="https://git-scm.com/book/en/v2/Getting-Started-What-is-Git%3F" target="_blank" rel="noopener noreferrer">Git</a> to store our code in a central location and <a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer">Visual Studio Code</a> to perform the coding. Choose your favourite source control system and IDE, and dive into the next sections! ðŸš€</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-repo">GitHub Repo<a class="hash-link" aria-label="Direct link to GitHub Repo" title="Direct link to GitHub Repo" href="/personal-blog/blog/opentofu-rke2-cilium-azure#github-repo">â€‹</a></h2>
<p>The showcase repository is available <a href="https://github.com/egrosdou01/opentofu-rke2-cilium-azure/tree/main" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="outline-project-structure">Outline Project Structure<a class="hash-link" aria-label="Direct link to Outline Project Structure" title="Direct link to Outline Project Structure" href="/personal-blog/blog/opentofu-rke2-cilium-azure#outline-project-structure">â€‹</a></h2>
<p>Like with any Terraform project, we will create several <code>.tf</code> files to store the Infrastructure as Code (IaC) definitions. For best practices, have a look at the <a href="https://spacelift.io/blog/opentofu-tutorial#opentofu-best-practices" target="_blank" rel="noopener noreferrer">link</a>.</p>
<p>In your favourite IDE, create a new project and create the below file structure.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="file-structure">File structure<a class="hash-link" aria-label="Direct link to File structure" title="Direct link to File structure" href="/personal-blog/blog/opentofu-rke2-cilium-azure#file-structure">â€‹</a></h3>
<ul>
<li><code>main.tf</code>: Contains the resource blocks that define the resources to be created in the Azure cloud</li>
<li><code>variables.tf</code>: Contains the variable declaration used in the resource blocks</li>
<li><code>providers.tf</code>: Contains the required providers used in the resource blocks</li>
<li><code>data.tf</code>: Contains several data retrieved from the outside and used it through the resource creation</li>
<li><code>output.tf</code>: Contains the output that needs to be generated on successful completion of the OpenTofu plan/apply</li>
<li><code>*.tfvars</code>: Contains the default values of the specified variables</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="providerstf">providers.tf<a class="hash-link" aria-label="Direct link to providers.tf" title="Direct link to providers.tf" href="/personal-blog/blog/opentofu-rke2-cilium-azure#providerstf">â€‹</a></h2>
<p>The <code>providers.tf</code> file holds the required providers that will be used for the creation of the relevant resources. OpenTofu configurations must declare which providers they require so that OpenTofu can install and use them.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  required_version = &quot;~&gt; 1.8.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  required_providers {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rancher2 = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source  = &quot;opentofu/rancher2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      version = &quot;4.1.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source  = &quot;opentofu/local&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      version = &quot;2.5.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    http = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source  = &quot;opentofu/http&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      version = &quot;3.4.4&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">provider &quot;rancher2&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  api_url   = var.rancher2_api_url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  token_key = var.rancher2_token_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>It is a good practice to avoid specifying sensitive data in the <code>variables.tf</code> file. The <code>providers.tf</code> file expects the <code>rancher2_api_url</code> and <code>rancher2_token_key</code> variables. Following the best practices, we can have a file that exports the required variable name and value. From a terminal window, we set the <a href="https://www.digitalocean.com/community/tutorials/how-to-read-and-set-environmental-and-shell-variables-on-linux" target="_blank" rel="noopener noreferrer">source</a> pointing to the file before performing any IaC actions.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="datatf">data.tf<a class="hash-link" aria-label="Direct link to data.tf" title="Direct link to data.tf" href="/personal-blog/blog/opentofu-rke2-cilium-azure#datatf">â€‹</a></h2>
<p>The <code>data.tf</code> file holds the code to download relevant information about the kube-vip installation. The information will be used later on in the <code>main.tf</code> file while defining the RKE2 cluster configuration.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Download the kube-vip required RBAC manifest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data &quot;http&quot; &quot;kube_vip_rbac&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  url = &quot;https://kube-vip.io/manifests/rbac.yaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Download a specific kube-vip version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data &quot;http&quot; &quot;kube_vip_version&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  method = &quot;GET&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  url    = &quot;https://api.github.com/repos/kube-vip/kube-vip/releases#v0.8.2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Download the kube-vip-cloud-provider required manifest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data &quot;http&quot; &quot;kube_vip_cloud_provider&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  url = &quot;https://raw.githubusercontent.com/kube-vip/kube-vip-cloud-provider/main/manifest/kube-vip-cloud-controller.yaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="outputtf">output.tf<a class="hash-link" aria-label="Direct link to output.tf" title="Direct link to output.tf" href="/personal-blog/blog/opentofu-rke2-cilium-azure#outputtf">â€‹</a></h2>
<p>In the file, we can specify anything we want based on the use case at hand. For this demonstration, we keep it simple. We would display only the RKE2 <code>cluster-name</code> and <code>cluster-id</code>.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Display the RKE2 Cluster Name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;rke2_cluster_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = rancher2_cluster_v2.rke2.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Display the RKE2 Cluster ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;rancher_cluster_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = data.rancher2_project.system.cluster_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="maintf">main.tf<a class="hash-link" aria-label="Direct link to main.tf" title="Direct link to main.tf" href="/personal-blog/blog/opentofu-rke2-cilium-azure#maintf">â€‹</a></h2>
<p>The file contains the logic for creating virtual machines and installing RKE2 on top. We will break the <code>main.tf</code> file into smaller pieces and try to go through them in more detail.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="define-the-azure-cloud-credentials">Define the Azure Cloud Credentials<a class="hash-link" aria-label="Direct link to Define the Azure Cloud Credentials" title="Direct link to Define the Azure Cloud Credentials" href="/personal-blog/blog/opentofu-rke2-cilium-azure#define-the-azure-cloud-credentials">â€‹</a></h3>
<p>It is a requirement to have valid Azure cloud credentials before proceeding with the RKE2 installation. If you are unsure how to get the below variable details, have a look at my previous post <a href="/personal-blog/blog/rancher-rke2-cilium-azure#set-up-rancher-cloud-credentials">here</a>.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Create the Azure Cloud Credentials in Rancher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;rancher2_cloud_credential&quot; &quot;azure_creds&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name = &quot;Azure Credentials&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  azure_credential_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client_id       = var.azure_env.az_client_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client_secret   = var.azure_env.az_client_secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subscription_id = var.azure_env.az_subscription_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="define-the-machine-configuration">Define the Machine Configuration<a class="hash-link" aria-label="Direct link to Define the Machine Configuration" title="Direct link to Define the Machine Configuration" href="/personal-blog/blog/opentofu-rke2-cilium-azure#define-the-machine-configuration">â€‹</a></h3>
<p>The below resource will create the required virtual machines for the RKE2 cluster. Here, we define two types of nodes, the controller and the worker node. They could have the same or different hardware specifications based on the use case scenario that needs to be covered.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Create the different nodes for RKE2 (controller and worker node)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;rancher2_machine_config_v2&quot; &quot;nodes&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for_each      = var.node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  generate_name = each.value.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  azure_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_size            = each.value.agent_disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image                = each.value.image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location             = each.value.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    managed_disks        = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_port            = each.value.open_port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private_address_only = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource_group       = each.value.resource_group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage_type         = each.value.storage_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size                 = each.value.agent_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="define-the-rke2-condifugration">Define the RKE2 Condifugration<a class="hash-link" aria-label="Direct link to Define the RKE2 Condifugration" title="Direct link to Define the RKE2 Condifugration" href="/personal-blog/blog/opentofu-rke2-cilium-azure#define-the-rke2-condifugration">â€‹</a></h3>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># RKE2 configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;rancher2_cluster_v2&quot; &quot;rke2&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  annotations           = var.rancher_env.cluster_annotations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kubernetes_version    = var.rancher_env.rke2_version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels                = var.rancher_env.cluster_labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable_network_policy = var.rancher_env.network_policy # Option to enable or disable Project Network Isolation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                  = var.rancher_env.cluster_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rke_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # You can create a Terraform template and polulate the values of the file based on the variables defined below</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    additional_manifest = templatefile(&quot;${path.module}/files/kube-vip-daemonset.tfmpl&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int_name                = var.kube_vip.int_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kube_vip_rbac           = data.http.kube_vip_rbac.response_body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kube_vip_version        = jsondecode(data.http.kube_vip_version.response_body)[0][&quot;tag_name&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kube_vip_address        = var.kube_vip.kube_vip_address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kube_vip_pool           = var.kube_vip.kube_vip_pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kube_vip_cloud_provider = data.http.kube_vip_cloud_provider.response_body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Define the Helm chart values for the Cilium installation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chart_values = &lt;&lt;-EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Have a look at https://github.com/cilium/cilium/blob/main/install/kubernetes/cilium/values.yaml to include additional custom values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rke2-cilium:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        k8sServiceHost: 127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        k8sServicePort: 6443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kubeProxyReplacement: true # Enable Cilium with Kube-Proxy replacement on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Define the Rancher global settings for the whole cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    machine_global_config = &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cni: &quot;cilium&quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cluster-cidr: ${var.rke_cluster_cidr}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      service-cidr: ${var.rke_service_cidr}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      disable-kube-proxy: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Sepcify the role of each node based on the name of the node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dynamic &quot;machine_pools&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      for_each = var.node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      content {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cloud_credential_secret_name = rancher2_cloud_credential.azure_creds.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        control_plane_role           = machine_pools.key == &quot;controller&quot; ? true : false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        etcd_role                    = machine_pools.key == &quot;controller&quot; ? true : false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name                         = machine_pools.value.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        quantity                     = machine_pools.value.quantity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker_role                  = machine_pools.key != &quot;controller&quot; ? true : false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        machine_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          kind = rancher2_machine_config_v2.nodes[machine_pools.key].kind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name = rancher2_machine_config_v2.nodes[machine_pools.key].name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    machine_selector_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      config = null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="variablestf">variables.tf<a class="hash-link" aria-label="Direct link to variables.tf" title="Direct link to variables.tf" href="/personal-blog/blog/opentofu-rke2-cilium-azure#variablestf">â€‹</a></h2>
<p>Outline how the variables used in the <code>main.tf</code> file should look like. If required, perform additional validations to the code.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;azure_env&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Azure required details&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    az_client_id       = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    az_client_secret   = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    az_subscription_id = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;kube_vip&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;kube-vip basic settings&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int_name         = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kube_vip_address = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kube_vip_pool    = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;node&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Two RKE2 nodes to be configured&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    controller = object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name           = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      agent_disk     = optional(number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image          = optional(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      location       = optional(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      open_port      = optional(list(string))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resource_group = optional(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      storage_type   = optional(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      agent_type     = optional(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      quantity       = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    worker = object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name           = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      agent_disk     = optional(number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image          = optional(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      location       = optional(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      open_port      = optional(list(string))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resource_group = optional(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      storage_type   = optional(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      agent_type     = optional(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      quantity       = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;rancher2_api_url&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;URL to Rancher Server API&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;rancher2_token_key&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Rancher API Token key&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="terraformtfvars">terraform.tfvars<a class="hash-link" aria-label="Direct link to terraform.tfvars" title="Direct link to terraform.tfvars" href="/personal-blog/blog/opentofu-rke2-cilium-azure#terraformtfvars">â€‹</a></h3>
<p>The file holds the input for the resource creation. Depending on how the <code>variables.tf</code> file looks like, we should set a similar structure to define the variables initialisation.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kube_vip = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int_name         = &quot;eth0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kube_vip_address = &quot;x.x.x.x&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kube_vip_pool    = &quot;x.x.x.x-x.x.x.x&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  controller = { name = &quot;controller&quot;, quantity = 1, agent_disk = 30, image = &quot;canonical:UbuntuServer:18.04-LTS:latest&quot;, location = &quot;westus&quot;, resource_group = &quot;rancher-rg&quot;, storage_type = &quot;Standard_LRS&quot;, agent_type = &quot;Standard_D2_v2&quot; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  worker  = { name = &quot;worker&quot;, quantity = 1, agent_disk = 30, image = &quot;canonical:UbuntuServer:18.04-LTS:latest&quot;, location = &quot;westus&quot;, resource_group = &quot;rancher-rg&quot;, storage_type = &quot;Standard_LRS&quot;, agent_type = &quot;Standard_D2_v2&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rancher_env = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster_annotations = { &quot;rke2&quot; = &quot;demo&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster_labels      = { &quot;rke2&quot; = &quot;azure-demo&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rke2_version     = &quot;v1.28.11+rke2r1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster_id       = &quot;eleni-azure-01&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network_policy   = &quot;false&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke_cluster_cidr   = &quot;10.42.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke_service_cidr   = &quot;10.43.0.0/16&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The kube-vip interface name defined in the file represents the network interface from the virtual machines created in the Azure Cloud environment.</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The node definition will allow you to create an RKE2 cluster based on the free-credits subscription. If the above are changed, the deployment might fail due to subscription limitations.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="execution">Execution<a class="hash-link" aria-label="Direct link to Execution" title="Direct link to Execution" href="/personal-blog/blog/opentofu-rke2-cilium-azure#execution">â€‹</a></h2>
<p>To plan and apply the resources, use the below commands.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ tofu init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ tofu plan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ tofu apply</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>When performing the <code>tofu init</code> command, I received the below warning.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- Installing opentofu/rancher2 v4.1.0...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Installed opentofu/rancher2 v4.1.0. Signature validation was skipped due to the registry not containing GPG keys for this provider</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I raised a <code>GitHub</code> <a href="https://github.com/rancher/terraform-provider-rancher2/issues/1385" target="_blank" rel="noopener noreferrer">issue</a> with the Terraform Rancher2 Provider.</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Check out the <code>.terraform/providers/registry.opentofu.org</code> directory with the providers sourced from the OpenTofu registry.</p></div></div>
<p>The above will first create the Azure Cloud Credentials in the Rancher instance, then continue with the RKE2 cluster creation. The <code>tofu apply</code> command might take up to 10 min. Just wait for it to complete.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="validation-1">Validation<a class="hash-link" aria-label="Direct link to Validation" title="Direct link to Validation" href="/personal-blog/blog/opentofu-rke2-cilium-azure#validation-1">â€‹</a></h2>
<p>If the <code>tofu apply</code> command completes successfully, we should have a cluster with two nodes. One <code>controller</code> and one <code>worker</code> node in the <code>westus</code> region.</p>
<p><img decoding="async" loading="lazy" alt="title image reading &amp;quot;Rancher2 Terraform Provider&amp;quot;" src="/personal-blog/assets/images/rke2_opentofu_azure-6b9ac87af58d9ad3a09d237229e62e3b.png" width="3452" height="1988" class="img_ev3q"></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectk get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                       STATUS   ROLES                       AGE     VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eleni-azure-01-controller-49abc099-ftvnv   Ready    control-plane,etcd,master   11m     v1.28.11+rke2r1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eleni-azure-01-worker-87b90346-swd64       Ready    worker                      7m59s   v1.28.11+rke2r1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectk get pods -n kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                                READY   STATUS      RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-5rfh4                                                        1/1     Running     0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-operator-6bd79b68b5-ch979                                    1/1     Running     0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-vmt9d                                                        1/1     Running     0          8m8s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloud-controller-manager-eleni-azure-01-controller-49abc099-ftvnv   1/1     Running     0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">etcd-eleni-azure-01-controller-49abc099-ftvnv                       1/1     Running     0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm-install-rke2-cilium-kqmkc                                      0/1     Completed   0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm-install-rke2-coredns-m5f8f                                     0/1     Completed   0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm-install-rke2-ingress-nginx-vzdps                               0/1     Completed   0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm-install-rke2-metrics-server-5t4sj                              0/1     Completed   0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm-install-rke2-snapshot-controller-crd-jvdtd                     0/1     Completed   0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm-install-rke2-snapshot-controller-zpkhv                         0/1     Completed   0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm-install-rke2-snapshot-validation-webhook-6qlpx                 0/1     Completed   0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-apiserver-eleni-azure-01-controller-49abc099-ftvnv             1/1     Running     0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-controller-manager-eleni-azure-01-controller-49abc099-ftvnv    1/1     Running     0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-scheduler-eleni-azure-01-controller-49abc099-ftvnv             1/1     Running     0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-vip-5vlxw                                                      1/1     Running     0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-vip-cloud-provider-85fd9b9cf7-n24fd                            1/1     Running     0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-coredns-rke2-coredns-84b9cb946c-5wch4                          1/1     Running     0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-coredns-rke2-coredns-84b9cb946c-zfkm5                          1/1     Running     0          8m5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-coredns-rke2-coredns-autoscaler-b49765765-4gkwf                1/1     Running     0          11m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-ingress-nginx-controller-hljpx                                 1/1     Running     0          6m15s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-metrics-server-655477f655-v2j6g                                1/1     Running     0          6m38s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-snapshot-controller-59cc9cd8f4-66942                           1/1     Running     0          6m39s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rke2-snapshot-validation-webhook-54c5989b65-zqxgz                   1/1     Running     0          6m38s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="delete-resources">Delete Resources<a class="hash-link" aria-label="Direct link to Delete Resources" title="Direct link to Delete Resources" href="/personal-blog/blog/opentofu-rke2-cilium-azure#delete-resources">â€‹</a></h2>
<p>It is very easy to delete the resources created, simply perform the <code>tofu destroy</code> and confirm the action. The deletion of the resources will take up to 2 minutes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ï¸-contact">âœ‰ï¸ Contact<a class="hash-link" aria-label="Direct link to âœ‰ï¸ Contact" title="Direct link to âœ‰ï¸ Contact" href="/personal-blog/blog/opentofu-rke2-cilium-azure#ï¸-contact">â€‹</a></h2>
<p>If you have any questions, feel free to get in touch! You can use the <code>Discussions</code> option found <a href="https://github.com/egrosdou01/personal-blog/discussions" target="_blank" rel="noopener noreferrer">here</a> or reach out to me on any of the social media platforms provided. ðŸ˜Š</p>
<p>We look forward to hearing from you!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusions">Conclusions<a class="hash-link" aria-label="Direct link to Conclusions" title="Direct link to Conclusions" href="/personal-blog/blog/opentofu-rke2-cilium-azure#conclusions">â€‹</a></h2>
<p>This is it! Automate the creation of RKE2 clusters in Azure with OpenTofu! ðŸŽ‰</p>
<p>It&#x27;s a wrap for this post! ðŸŽ‰ Thanks for reading! Stay tuned for more exciting updates!</p></div><div class="blog-post-spacing"></div><div class="social-share-container"><div class="social-share"><p class="shareText_x93L">SHARE</p><button class="react-share__ShareButton shareButton_AVfu" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="25" height="25"><circle cx="32" cy="32" r="32" fill="#0077B5"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button class="react-share__ShareButton shareButton_AVfu" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="25" height="25"><circle cx="32" cy="32" r="32" fill="#000000"></circle><path d="M 41.116 18.375 h 4.962 l -10.8405 12.39 l 12.753 16.86 H 38.005 l -7.821 -10.2255 L 21.235 47.625 H 16.27 l 11.595 -13.2525 L 15.631 18.375 H 25.87 l 7.0695 9.3465 z m -1.7415 26.28 h 2.7495 L 24.376 21.189 H 21.4255 z" fill="white"></path></svg></button><button class="react-share__ShareButton shareButton_AVfu" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="25" height="25"><circle cx="32" cy="32" r="32" fill="#FF5700"></circle><path d="M 53.34375 32 C 53.277344 30.160156 52.136719 28.53125 50.429688 27.839844 C 48.722656 27.148438 46.769531 27.523438 45.441406 28.800781 C 41.800781 26.324219 37.519531 24.957031 33.121094 24.863281 L 35.199219 14.878906 L 42.046875 16.320312 C 42.214844 17.882812 43.496094 19.09375 45.066406 19.171875 C 46.636719 19.253906 48.03125 18.183594 48.359375 16.644531 C 48.6875 15.105469 47.847656 13.558594 46.382812 12.992188 C 44.914062 12.425781 43.253906 13.007812 42.464844 14.367188 L 34.625 12.800781 C 34.363281 12.742188 34.09375 12.792969 33.871094 12.9375 C 33.648438 13.082031 33.492188 13.308594 33.441406 13.566406 L 31.070312 24.671875 C 26.617188 24.738281 22.277344 26.105469 18.59375 28.609375 C 17.242188 27.339844 15.273438 26.988281 13.570312 27.707031 C 11.863281 28.429688 10.746094 30.089844 10.71875 31.941406 C 10.691406 33.789062 11.757812 35.484375 13.441406 36.257812 C 13.402344 36.726562 13.402344 37.195312 13.441406 37.664062 C 13.441406 44.832031 21.792969 50.65625 32.097656 50.65625 C 42.398438 50.65625 50.753906 44.832031 50.753906 37.664062 C 50.789062 37.195312 50.789062 36.726562 50.753906 36.257812 C 52.363281 35.453125 53.371094 33.800781 53.34375 32 Z M 21.34375 35.199219 C 21.34375 33.433594 22.777344 32 24.542969 32 C 26.3125 32 27.742188 33.433594 27.742188 35.199219 C 27.742188 36.96875 26.3125 38.398438 24.542969 38.398438 C 22.777344 38.398438 21.34375 36.96875 21.34375 35.199219 Z M 39.9375 44 C 37.664062 45.710938 34.871094 46.582031 32.03125 46.464844 C 29.191406 46.582031 26.398438 45.710938 24.128906 44 C 23.847656 43.65625 23.871094 43.15625 24.183594 42.839844 C 24.5 42.527344 25 42.503906 25.34375 42.785156 C 27.269531 44.195312 29.617188 44.90625 32 44.800781 C 34.386719 44.929688 36.746094 44.242188 38.6875 42.847656 C 39.042969 42.503906 39.605469 42.511719 39.953125 42.863281 C 40.296875 43.21875 40.289062 43.785156 39.9375 44.128906 Z M 39.359375 38.527344 C 37.59375 38.527344 36.160156 37.09375 36.160156 35.328125 C 36.160156 33.5625 37.59375 32.128906 39.359375 32.128906 C 41.128906 32.128906 42.558594 33.5625 42.558594 35.328125 C 42.59375 36.203125 42.269531 37.054688 41.65625 37.6875 C 41.046875 38.316406 40.203125 38.664062 39.328125 38.65625 Z M 39.359375 38.527344" fill="white"></path></svg></button><button class="react-share__ShareButton shareButton_AVfu" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="25" height="25"><circle cx="32" cy="32" r="32" fill="#7f7f7f"></circle><path d="M17,22v20h30V22H17z M41.1,25L32,32.1L22.9,25H41.1z M20,39V26.6l12,9.3l12-9.3V39H20z" fill="white"></path></svg></button></div></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a title="OpenTofu is a fork of Terraform" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/opentofu">OpenTofu</a></li><li class="tag_QGVx"><a title="eBPF-based Networking, Security, and Observability for Kubernetes" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/cilium">Cilium</a></li><li class="tag_QGVx"><a title="Rancher Kubernetes Engine 2 (RKE2)" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/rke2">RKE2</a></li><li class="tag_QGVx"><a title="Azure Cloud" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/azure">Azure</a></li><li class="tag_QGVx"><a title="Open source software" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/open-source">Open Source</a></li><li class="tag_QGVx"><a title="Container orchestration platform for automating application deployment, scaling, and management" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/kubernetes">Kubernetes</a></li><li class="tag_QGVx"><a title="Operational framework that uses Git as a single source of truth for declarative infrastructure and applications" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/gitops">GitOps</a></li><li class="tag_QGVx"><a title="Set of practices that combines software development and IT operations" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/devops">DevOps</a></li><li class="tag_QGVx"><a title="The year the post went online" class="tag_zVej tagRegular_sFm0" href="/personal-blog/blog/tags/2024">2024</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/personal-blog/blog/civo-navigate-berlin-2024"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Civo Navigate Berlin 2024</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/personal-blog/blog/sveltos-templating-cilium-cluster-mesh"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Sveltos Templating: Cilium Cluster Mesh in One Run</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#introduction">Introduction</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#lab-setup">Lab Setup</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#prerequisites">Prerequisites</a><ul><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#rancher-server">Rancher Server</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#azure-free-credits">Azure Free Credits</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#install-opentofu">Install OpenTofu</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#step-0-pre-work">Step 0: Pre-work</a><ul><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#step-01-familiarise-with-opentofu-registry">Step 0.1: Familiarise with OpenTofu Registry</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#step-02-familiarise-with-rancher2-provider">Step 0.2: Familiarise with Rancher2 Provider</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#step-03-choose-integrated-development-environment-ide">Step 0.3: Choose Integrated Development Environment (IDE)</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#github-repo">GitHub Repo</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#outline-project-structure">Outline Project Structure</a><ul><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#file-structure">File structure</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#providerstf">providers.tf</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#datatf">data.tf</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#outputtf">output.tf</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#maintf">main.tf</a><ul><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#define-the-azure-cloud-credentials">Define the Azure Cloud Credentials</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#define-the-machine-configuration">Define the Machine Configuration</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#define-the-rke2-condifugration">Define the RKE2 Condifugration</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#variablestf">variables.tf</a><ul><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#terraformtfvars">terraform.tfvars</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#execution">Execution</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#validation-1">Validation</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#delete-resources">Delete Resources</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#ï¸-contact">âœ‰ï¸ Contact</a></li><li><a class="table-of-contents__link toc-highlight" href="/personal-blog/blog/opentofu-rke2-cilium-azure#conclusions">Conclusions</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/personal-blog/">About me</a></li></ul></div><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://linkedin.com/in/eleni-grosdouli-85a1a5116" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/egrosdou01" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://medium.com/@eleni.grosdouli" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/personal-blog/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 Eleni Grosdouli Blog</div></div></div></footer></div>
</body>
</html>